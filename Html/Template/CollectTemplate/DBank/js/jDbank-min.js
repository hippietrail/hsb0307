var jDbank=$;(function(){jDbank.data._globalData={};jDbank.data._blockData={};var JD=jDbank.data;JD.setGlobal=function(name,value){JD._globalData[name]=value};JD.getGlobal=function(name){return typeof(JD._globalData[name])!="undefined"?JD._globalData[name]:null};JD.deleteGlobal=function(name){if(typeof(JD._globalData[name])!="undefined"){delete JD._globalData[name]}};JD.getGlobalVarNames=function(){var arrNames=new Array();for(var key in JD._globalData){arrNames[arrNames.length]=key}};JD.setBlock=function(name,value){JD._blockData[name]=value};JD.getBlock=function(name){return typeof(JD._blockData[name])!="undefined"?JD._blockData[name]:null};JD.deleteBlock=function(name){if(typeof(JD._blockData[name])!="undefined"){delete JD._blockData[name]}};JD.getBlockVarNames=function(){var arrNames=new Array();for(var key in JD._blockData){arrNames[arrNames.length]=key}};jDbank.util={};var JU=jDbank.util;JU.template=function(templateStr,mapData){var re,key;for(key in mapData){re=new RegExp("\\{"+key+"\\}","ig");templateStr=templateStr.replace(re,mapData[key])}return templateStr};JU.getPosition=function(){return document.documentElement.getBoundingClientRect&&function(o){var pos=o.getBoundingClientRect(),root=o.ownerDocument||o.document;return{left:pos.left+root.documentElement.scrollLeft,top:pos.top+root.documentElement.scrollTop}}||function(o){var x=0,y=0;do{x+=o.offsetLeft;y+=o.offsetTop}while((o=o.offsetParent));return{left:x,top:y}}}();JU.clone=function(data){if(typeof(data)!="object"){return null}var obj={};if(!data.length){for(key in data){obj[key]=data[key]}}else{obj=[];for(var i=0;i<data.length;i++){obj[i]=data[i]}}return obj};JU.hasClass=function(el,className){return className&&(" "+el.className+" ").indexOf(" "+className+" ")>-1};JU.addClass=function(el,className){if(el.className===""){el.className=className}else{if(el.className!==""&&!JU.hasClass(el,className)){el.className=el.className+" "+className}}};JU.removeClass=function(el,className){if(JU.hasClass(el,className)){el.className=(" "+el.className+" ").replace(" "+className+" "," ").replace(/^ | $/g,"")}};JU.sortTable=function(dTable,colIndex,sortType,sortFun,tbodynum){if(tbodynum=="1"){var dTbody=dTable.getElementsByTagName("tbody")[1]}else{var dTbody=dTable.getElementsByTagName("tbody")[0]}var arrTable=[],i=0,j=0,iRows,dTrs;dTrs=jDbank(dTbody).children();iRows=dTrs.length;if(iRows===0){return}if(iRows===1){return}var iCols=dTrs[0].cells.length;if(iCols===0){return}var orderFirst=null,oData=null;colIndex=colIndex.toString().split("-");if(colIndex[1]){orderFirst=colIndex[1].toString()}colIndex=parseInt(colIndex[0]);arrTable=[];for(i=0;i<iRows;i++){for(j=0;j<iCols;j++){if(j===colIndex){if(orderFirst&&dTrs[i].getAttribute("sdata")){oData=eval("("+dTrs[i].getAttribute("sdata")+")");arrTable[i]="1_"+(typeof(oData[orderFirst])!="undefined"?oData[orderFirst]:"")+"_"+dTrs[i].cells[j].innerHTML.replace(/<\/?[^>]*>/g,"").replace(/[\n\r]+/g,"").replace(/[ ]{2,}/g,"")+"|"+i}else{arrTable[i]=dTrs[i].cells[j].innerHTML.replace(/<\/?[^>]*>/g,"").replace(/[\n\r]+/g,"").replace(/[ ]{2,}/g,"")+"|"+i}}else{continue}}}if(typeof(sortFun)=="function"){arrTable.sort(sortFun)}else{arrTable.sort()}var newDoc=document.createDocumentFragment();var newTbody=document.createElement("tbody");newTbody.setAttribute("sdata",dTbody.getAttribute("sdata"));var dTr,dTd,iIndex;var fnAddTr=function(i){if(!arrTable[i]){return}iIndex=arrTable[i].split("|")[1];dTr=document.createElement("tr");dTr.onmouseover=dTrs[iIndex].onmouseover;dTr.onmouseout=dTrs[iIndex].onmouseout;dTr.setAttribute("sdata",dTrs[iIndex].getAttribute("sdata"));for(j=0;j<iCols;j++){dTd=document.createElement("td");dTd.className=dTrs[iIndex].cells[j].className;dTd.innerHTML=dTrs[iIndex].cells[j].innerHTML;dTr.appendChild(dTd)}newDoc.appendChild(dTr)};dTable.style.display="none";if(sortType=="asc"){for(i=0;i<iRows;i++){fnAddTr(i)}}else{if(sortType=="desc"){for(i=iRows-1;i>=0;i--){fnAddTr(i)}}}dTable.removeChild(dTbody);dTbody=null;newTbody.appendChild(newDoc);dTable.appendChild(newTbody);dTable.style.display="";return arrTable};JU.history_={intervalHash:null,dIframeDoc:null,historyMap:{},intervalCheckHash:null,currentUrlHash:null,logPre:"h",hashChangeDelay:500,rebackDelay:1000};JU.logHistory=function(){var hash=JU.history_.logPre+parseInt(Math.random()*1000);location.hash=hash;JU.history_.currentUrlHash=hash;if(document.all&&!/MSIE 6.0/ig.test(navigator.appVersion)){if(!document.getElementById("dbkhistory")){var dIframe=document.createElement("iframe");dIframe.style.display="none";dIframe.id="dbkhistory";document.body.appendChild(dIframe)}JU.history_.dIframeDoc=document.getElementById("dbkhistory").contentWindow.document;JU.history_.dIframeDoc.open();JU.history_.dIframeDoc.close();JU.history_.dIframeDoc.location.hash=hash;if(!JU.history_.intervalHash){JU.history_.intervalHash=setInterval(function(){if(location.hash===""){return}JU.history_.dIframeDoc=document.getElementById("dbkhistory").contentWindow.document;if(JU.history_.dIframeDoc.location.hash!=location.hash){location.hash=JU.history_.dIframeDoc.location.hash}},JU.history_.hashChangeDelay)}}var args=Array.prototype.slice.call(arguments,0);var This=args[0];args.shift();JU.history_.historyMap[hash]={func:this,This:This,args:args,fromHistory:true}};JU.history_.intervalCheckHash=setInterval(function(){document.title=jDbank.data.getGlobal("netDiskTitle")?jDbank.data.getGlobal("netDiskTitle"):document.title.replace(/#.*$/g,"");var hash=location.hash.replace("#","");if(hash===""){return}if(JU.history_.currentUrlHash!=hash&&JU.history_.historyMap[hash]){JU.history_.currentUrlHash=hash;var args=Array.prototype.slice.call(JU.history_.historyMap[hash].args,0);args.push(JU.history_.historyMap[hash].fromHistory);JU.history_.historyMap[hash].func.apply(JU.history_.historyMap[hash].This,args)}},JU.history_.rebackDelay);JU.loadModule=function(moduleId,serviceUrl,parentModule,callback){var dDiv=document.getElementById(moduleId);if(dDiv){dDiv.parentNode.removeChild(dDiv)}var dChild,arrAttrs,i;jDbank.get(serviceUrl,{rnd:parseInt(Math.random()*1000)},function(data,textStatus){if(textStatus=="success"){dDiv=document.createElement("div");dDiv.innerHTML=data;dChild=jDbank(dDiv).children();if(dChild[0]){arrAttrs=dChild[0].attributes;for(i=0;i<arrAttrs.length;i++){if(/.*Url$/ig.test(arrAttrs[i].name)||/^sData[\w]*/ig.test(arrAttrs[i].name)){dDiv.setAttribute(arrAttrs[i].name,arrAttrs[i].value)}}}dDiv.className=dChild[0]?dChild[0].className:"";dDiv.innerHTML=dChild[0]?dChild[0].innerHTML:"";dDiv.id=moduleId;if(typeof(parentModule)=="undefined"){document.body.appendChild(dDiv)}else{parentModule.appendChild(dDiv)}if(typeof(callback)!="undefined"){callback.call(dDiv)}}else{jDbank.ui.showMsg("request fail.")}},"html")};JU.getAvaiFileLen=function(iWidth){if(typeof(iWidth)=="undefined"){var iWidth=screen.width;if(iWidth>1152&&iWidth<=1280){return 50}else{if(iWidth>800&&iWidth<=1024){return 30}else{if(iWidth<=800){return 15}else{if(iWidth>1280&&iWidth<=1440){return 60}else{if(iWidth>1024&&iWidth<=1152){return 40}else{return 60}}}}}}else{return parseInt((iWidth-50)/13-1)}};jDbank.ajax._formObjArr=null;jDbank.ajax.postBlock=function(url,blockName,callback,datatype){};jDbank.ajax.postForm=function(url,formId,callback,datatype){};jDbank.ajax.autoFillForm=function(jsonData){};var JA=jDbank.ajax;JA.postBlock=function(url,blockName,callback,type){var sData="";var blockData=jDbank.data.getBlock(blockName);if(typeof(blockData)=="undefined"){return}else{if(typeof(blockData)=="string"){sData=blockName+"="+blockData}else{if(typeof(blockData)=="object"){for(var key in blockData){sData+=key+"="+blockData[key]+"&"}sData=sData.replace(/\&$/,"")}}}jDbank.post(url,sData,callback,type)};JA.postForm=function(url,formId,callback,type){var formObj=document.getElementById(formId);if(!formObj){return}var sData,dInputs,dTextareas,dSelects,i=0,arrObj=new Array();sData="";dInputs=formObj.getElementsByTagName("input");dTextareas=formObj.getElementsByTagName("textarea");dSelects=formObj.getElementsByTagName("select");for(i=0;i<dInputs.length;i++){if(dInputs[i].name&&dInputs[i].type=="radio"&&dInputs[i].checked){arrObj[arrObj.length]=dInputs[i]}else{if(dInputs[i].name&&dInputs[i].type=="checkbox"&&dInputs[i].checked){arrObj[arrObj.length]=dInputs[i]}else{if(dInputs[i].name&&dInputs[i].type!="radio"&&dInputs[i].type!="checkbox"){arrObj[arrObj.length]=dInputs[i]}}}}for(i=0;i<dTextareas.length;i++){if(dTextareas[i].name){arrObj[arrObj.length]=dTextareas[i]}}for(i=0;i<dSelects.length;i++){if(dSelects[i].name){arrObj[arrObj.length]=dSelects[i]}}for(i=0;i<arrObj.length;i++){if(i!=arrObj.length-1){if(arrObj[i].tagName.toLowerCase()=="select"){if(arrObj[i].options.length>0){sData+=arrObj[i].name+"="+arrObj[i].options[arrObj[i].selectedIndex].value+"&"}}else{sData+=arrObj[i].name+"="+arrObj[i].value+"&"}}else{if(arrObj[i].tagName.toLowerCase()=="select"){if(arrObj[i].options.length>0){sData+=arrObj[i].name+"="+arrObj[i].options[arrObj[i].selectedIndex].value}}else{sData+=arrObj[i].name+"="+arrObj[i].value}}}JA._formObjArr=arrObj;jDbank.post(url,sData,callback,type)};JA.autoFillForm=function(jsonData){if(!JA._formObjArr){return}for(var i=0;i<JA._formObjArr.length;i++){JA._formObjArr[i].value=jsonData[JA._formObjArr[i].name]}};if(!jDbank.ui){jDbank.ui={}}jDbank.ui._lastWin=null;jDbank.ui._tipMsgObj=document.getElementById("dbkmsgtip")?document.getElementById("dbkmsgtip"):null;jDbank.ui._timer=null;jDbank.ui._waitgif="dbankwaitgif";jDbank.ui.mask=function(ifShow,maskId){if(typeof(maskId)=="undefined"){var maskId="dbankmask"}var dDiv=document.getElementById(maskId);if(!dDiv){dDiv=document.createElement("div");dDiv.id=maskId;document.body.appendChild(dDiv)}if(ifShow){if(dDiv.style.display!="block"){dDiv.style.width=jDbank(document).width()+"px";dDiv.style.height=jDbank(document).height()+"px";dDiv.style.display="block"}}else{dDiv.style.display="none"}};jDbank.ui.disable=function(module){if(!module){jDbank.ui.mask(true,"dbankcover")}else{jDbank.ui.mask(true,"dbankcover");var oPos=jDbank(module).offset();var iHeight=jDbank(module).height();var iWidth=jDbank(module).width();var dCover=document.getElementById("dbankcover");dCover.style.height=iHeight+"px";dCover.style.width=iWidth+"px";dCover.style.top=oPos.top+"px";dCover.style.left=oPos.left+"px"}};jDbank.ui.release=function(){jDbank.ui.mask(false,"dbankcover");if(document.getElementById(jDbank.ui._waitgif)){document.getElementById(jDbank.ui._waitgif).style.display="none"}};jDbank.ui.setCenter=function(module){var iWinwidth=jDbank(window).width();var iWinheight=jDbank(window).height();var iBodyWidth=jDbank(document).width();var iBodyHeight=jDbank(document).height();var iMwidth=jDbank(module).width();var iMheight=jDbank(module).height();var iLeft=parseInt(iWinwidth/2-iMwidth/2>0?iWinwidth/2-iMwidth/2:iBodyWidth/2-iMwidth/2);var iTop=parseInt((iWinheight/2-iMheight/2>0?iWinheight/2-iMheight/2:iBodyHeight/2-iMheight/2)+jDbank(window).scrollTop());module.style.left=(iLeft>0?iLeft:0)+"px";module.style.top=(iTop>0?iTop:0)+"px"};jDbank.ui.showSubWindow=function(module,ifMask){ifMask=typeof(ifMask)!="undefined"?ifMask:true;if(ifMask){jDbank.ui.mask(true);module.style.display="block";jDbank.ui.setCenter(module);if(jDbank(module).height()>jDbank("#dbankmask").height()){jDbank("#dbankmask").height(jDbank(module).height()+10)}}else{module.style.display="block";jDbank.ui.setCenter(module)}if(module.id!="dbankalert"&&!jDbank(module).hasClass("dblgedlistmenu")){jDbank.ui._lastWin=module}};jDbank.ui.hideSubWindow=function(module,ifMask){if(module){module.style.display="none"}ifMask=typeof(ifMask)!="undefined"?ifMask:true;if(ifMask){jDbank.ui.mask(false)}};jDbank.ui.showMsg=function(msg,ifError,delay){var JUI=jDbank.ui;JUI._tipMsgObj=JUI._tipMsgObj?JUI._tipMsgObj:(document.getElementById("dbkmsgtip")?document.getElementById("dbkmsgtip"):null);if(!JUI._tipMsgObj){return}if(!delay){var delay=5}if(!ifError){JUI._tipMsgObj.className="green"}else{JUI._tipMsgObj.className="red"}JUI._tipMsgObj.innerHTML=msg;JUI._tipMsgObj.style.display="";if(JUI._timer){clearTimeout(JUI._timer)}JUI._timer=setTimeout(function(){JUI._tipMsgObj.style.display="none"},delay*1000)};jDbank.ui.sleep=function(delay){var JUI=jDbank.ui;JUI.disable();var dGif=document.getElementById(JUI._waitgif);if(!dGif){dGif=document.createElement("div");dGif.id=JUI._waitgif;dGif.innerHTML='<img src="/images/gif.gif"/>';document.body.appendChild(dGif)}dGif.style.display="block";if(delay){setTimeout(function(){JUI.release();dGif.style.display="none"},delay*1000)}};jDbank.ui.tree=function(idPre){this._selectFolder=null;this._newNode=null;this._startMove=false;this._isMoving=false;this._dragType=0;this._dragObj=null;this._overObj=null;this._moveToObj=null;this._alterType=0;this._treeObj=null;this._timer=null;this._eventObj={};this._eventMap={};this._sTreeHtml="";this.followDivId="dbtreefollowdrag";this.alterDivId="dbtreealter";this.hoverOpenDelay=1000;this.className="dbtree";this.rootId=1;this.maxNodeNameLength=jDbank.util.getAvaiFileLen();this._supportDrag=true;this._supportKeyboard=true;this._supportRename=true;this._rightMenuDivId="";this._supportRightMenu=true;this._dragDelayTime=300;this._supportHistory=true;this.data={};this.idPre=idPre||"a";this.dataUrl="";this.focusIndex=-1};jDbank.ui.tree.prototype.getSelectedFolder=function(){if(!this._selectFolder[0]){this._selectFolder=jDbank(document.getElementById(this.idPre+this.rootId).getElementsByTagName("span")[2])}return this._selectFolder[0].parentNode};jDbank.ui.tree.prototype.getSelectedNode=function(){if(!this._selectFolder[0]){this._selectFolder=jDbank(document.getElementById(this.idPre+this.rootId).getElementsByTagName("span")[2])}return this._selectFolder[0].parentNode};jDbank.ui.tree.prototype.getFolderName=function(obj){if(!this._selectFolder){this._selectFolder=jDbank(document.getElementById(this.idPre+this.rootId).getElementsByTagName("span")[2])}if(!obj){return this._selectFolder?this._selectFolder.html().replace(/<em>.*<\/em>/ig,""):-1}else{obj=jDbank(obj);if(obj[0].tagName.toLowerCase()=="span"){return obj.html().replace(/<em>.*<\/em>/ig,"")}else{if(obj.hasClass("item")){return obj.children("span.txt")[0].innerHTML.replace(/<em>.*<\/em>/ig,"")}}}return""};jDbank.ui.tree.prototype.getNodeName=function(obj){if(!this._selectFolder){this._selectFolder=jDbank(document.getElementById(this.idPre+this.rootId).getElementsByTagName("span")[2])}if(!obj){return this._selectFolder?this._selectFolder.html().replace(/<em>.*<\/em>/ig,""):-1}else{obj=jDbank(obj);if(obj[0].tagName.toLowerCase()=="span"){return obj.html().replace(/<em>.*<\/em>/ig,"")}else{if(obj.hasClass("item")){return obj.children("span.txt")[0].innerHTML.replace(/<em>.*<\/em>/ig,"")}}}return""};jDbank.ui.tree.prototype.setFolderName=function(obj,name){if(!obj){return}obj=jDbank(obj);var sEm;if(obj[0].tagName.toLowerCase()=="span"){sEm=obj[0].getElementsByTagName("em")[0]?obj[0].getElementsByTagName("em")[0].innerHTML:"";obj.html(name+(sEm!==""?"<em>"+sEm+"</em>":""))}else{if(obj.hasClass("item")){sEm=obj.children("span.txt")[0].getElementsByTagName("em")[0]?obj.children("span.txt")[0].getElementsByTagName("em")[0].innerHTML:"";obj.children("span.txt").html(name+(sEm!==""?"<em>"+sEm+"</em>":""))}}var id=this.getNodeId(obj);if(this.data[id]){this.data[id].name=name}};jDbank.ui.tree.prototype.setNodeName=function(obj,name){if(!obj){return}obj=jDbank(obj);if(obj[0].tagName.toLowerCase()=="span"){obj.text(name)}else{if(obj.hasClass("item")){obj.children("span.txt").text(name)}}var id=this.getNodeId(obj);if(this.data[id]){this.data[id].name=name}};jDbank.ui.tree.prototype.getFolderId=function(obj){if(!this._selectFolder){this._selectFolder=jDbank(document.getElementById(this.idPre+this.rootId).getElementsByTagName("span")[2])}var re=new RegExp(this.idPre,"ig");if(!obj){return this._selectFolder[0]&&this._selectFolder[0].parentNode?this._selectFolder[0].parentNode.getAttribute("id").replace(re,""):this.rootId}else{obj=jDbank(obj)[0];if(obj&&obj.tagName.toLowerCase()=="span"){return obj.parentNode.getAttribute("id").replace(re,"")}else{if(obj.tagName.toLowerCase()=="div"&&obj.className=="item"){return obj.getAttribute("id").replace(re,"")}}}return -1};jDbank.ui.tree.prototype.getNodeId=function(obj){if(!this._selectFolder){this._selectFolder=jDbank(document.getElementById(this.idPre+this.rootId).getElementsByTagName("span")[2])}var re=new RegExp(this.idPre,"ig");if(!obj){return this._selectFolder[0]&&this._selectFolder[0].parentNode?this._selectFolder[0].parentNode.getAttribute("id").replace(re,""):this.rootId}else{obj=jDbank(obj)[0];if(obj&&obj.tagName.toLowerCase()=="span"){return obj.parentNode.getAttribute("id").replace(re,"")}else{if(obj.tagName.toLowerCase()=="div"&&obj.className=="item"){return obj.getAttribute("id").replace(re,"")}}}return -1};jDbank.ui.tree.prototype.setFolderId=function(obj,id){if(!obj){return}obj=jDbank(obj);if(obj[0].tagName.toLowerCase()=="span"){obj.parent().attr("id",this.idPre+id)}else{if(obj.hasClass("item")){obj.attr("id",this.idPre+id)}}};jDbank.ui.tree.prototype.getParentFolderId=function(obj){return typeof(obj)!="undefined"?this.data[this.getFolderId(obj)]["parentid"]:this.data[this.getFolderId(this._selectFolder)]["parentid"]};jDbank.ui.tree.prototype.getParentNodeId=function(obj){return typeof(obj)!="undefined"?this.data[this.getNodeId(obj)]["parentid"]:this.data[this.getNodeId(this._selectFolder)]["parentid"]};jDbank.ui.tree.prototype.setParentFolderId=function(obj,id){if(!obj){return}this.data[this.getFolderId(obj)]["parentid"]=id};jDbank.ui.tree.prototype.setParentNodeId=function(obj,id){if(!obj){return}this.data[this.getNodeId(obj)]["parentid"]=id};jDbank.ui.tree.prototype.getHaveSubFolder=function(obj){return typeof(obj)!="undefined"?this.data[this.getFolderId(obj)]["havesubfolder"]:this.data[this.getFolderId(this._selectFolder)]["havesubfolder"]};jDbank.ui.tree.prototype.setHaveSubFolder=function(obj,ifHave){if(!obj){return}this.data[this.getFolderId(obj)]["havesubfolder"]=ifHave};jDbank.ui.tree.prototype.setIdPre=function(value){this.idPre=value};jDbank.ui.tree.prototype.setFollowDivId=function(value){this.followDivId=value};jDbank.ui.tree.prototype.setAlterDivId=function(value){this.alterDivId=value};jDbank.ui.tree.prototype.setHoverOpenDelay=function(value){this.hoverOpenDelay=value};jDbank.ui.tree.prototype.setClassName=function(value){this.className=value};jDbank.ui.tree.prototype.getRootId=function(){return this.rootId};jDbank.ui.tree.prototype.setRootId=function(value){this.rootId=value};jDbank.ui.tree.prototype.setRightMenuDivId=function(value){this._rightMenuDivId=value};jDbank.ui.tree.prototype.supportDrag=function(value){this._supportDrag=value};jDbank.ui.tree.prototype.supportKeyboard=function(value){this._supportKeyboard=value};jDbank.ui.tree.prototype.supportRename=function(value){this._supportRename=value};jDbank.ui.tree.prototype.supportRightMenu=function(value){this._supportRightMenu=value};jDbank.ui.tree.prototype.setFocusIndex=function(value){this.focusIndex=value};jDbank.ui.tree.prototype.getFocusIndex=function(){return this.focusIndex};jDbank.ui.tree.prototype.setDragDelayTime=function(value){this._dragDelayTime=value};jDbank.ui.tree.prototype.hasClass=function(node,className){if(!jDbank.util){return false}var dSpans=node.getElementsByTagName("span");if(dSpans&&dSpans[1]){return jDbank.util.hasClass(dSpans[1],className)}};jDbank.ui.tree.prototype.addClass=function(node,className){if(!jDbank.util){return}var dSpans=node.getElementsByTagName("span");if(dSpans&&dSpans[1]){jDbank.util.addClass(dSpans[1],className)}};jDbank.ui.tree.prototype.removeClass=function(node,className){if(!jDbank.util){return}var dSpans=node.getElementsByTagName("span");if(dSpans&&dSpans[1]){jDbank.util.removeClass(dSpans[1],className)}};jDbank.ui.tree.prototype.getEventHandler=function(eventObj){return this._eventMap[eventObj.type]?this._eventMap[eventObj.type]:function(eventObj){return true}};jDbank.ui.tree.prototype.getHandlerArguments=function(eventObj){var arr=new Array(eventObj);return this._eventMap[eventObj.type+"_arguments"]?arr.concat(this._eventMap[eventObj.type+"_arguments"]):arr};jDbank.ui.tree.prototype.bind=function(type,func){if(typeof(func)!="function"){return}this._eventMap[type]=func;this._eventMap[type+"_arguments"]=Array.prototype.slice.call(arguments,2)};jDbank.ui.tree.prototype.parseHTML=function(dSub){var dSubFolders=jDbank(dSub).children(),key;for(var i=0;i<dSubFolders.length;i++){if(dSubFolders[i].nodeType==1&&dSubFolders[i].tagName.toLowerCase()=="div"&&miniYUI.hasClass(dSubFolders[i],"item")){key=dSubFolders[i].getAttribute("id").replace(this.idPre,"");if(typeof(this.data[key])=="undefined"){this.data[key]={name:this.getFolderName(dSubFolders[i]),parentid:dSub.parentNode.getAttribute("id").replace(this.idPre,""),havesubfolder:jDbank(dSubFolders[i]).children("span.closed")[0]||jDbank(dSubFolders[i]).children("span.opened")[0]?1:0}}if(typeof(dSubFolders[i].data)=="undefined"){dSubFolders[i].data=this.data[key]}}}};jDbank.ui.tree.prototype.parseJSON=function(data){if(!data){return}var i=0,sHtml="";for(var key in data){sHtml+='<div class="item" id="'+this.idPre+key+'"><span class="ico'+(data[key]["havesubfolder"]==1?" closed":"")+'"></span>\n<span class="ico';if(typeof(data[key]["systemType"])!="undefined"&&data[key]["systemType"]=="201"){sHtml+=" recive"}else{if(typeof(data[key]["systemType"])!="undefined"&&data[key]["systemType"]=="202"){sHtml+=" mine"}}sHtml+=(data[key]["shared"]==1?" shared":"")+' fclosed"></span>\n<span class="txt">'+data[key]["name"]+"</span>"+(data[key]["havesubfolder"]==1?'<div class="subitem"></div>':"")+"</div>"}return sHtml};jDbank.ui.tree.prototype.makeTreeNode=function(currentId,data){var bHassub=false;if(typeof(data[currentId])=="undefined"){return}this._sTreeHtml+='<div class="item" id="'+this.idPre+currentId+'"><span class="ico';if(data[currentId]["havesubfolder"]==1){this._sTreeHtml+=" closed";bHassub=true}this._sTreeHtml+='"></span>\n<span class="ico';var curData=data[currentId];if(curData&&curData.systemType=="201"){this._sTreeHtml+=" recive"}else{if(curData&&curData.systemType=="202"){this._sTreeHtml+=" mine"}}this._sTreeHtml+=' fclosed"></span>\n<span class="txt">'+data[currentId]["name"]+"</span>";if(bHassub){this._sTreeHtml+='<div class="subitem">'}delete data[currentId];var childrenDatas=new Array();for(var key in data){if(data[key].parentid==currentId){childrenDatas[childrenDatas.length]=[key,data[key]]}}if(childrenDatas.length>0){for(var i=0;i<childrenDatas.length;i++){if(typeof(parseInt(childrenDatas[i][0]))!="number"){break}this.makeTreeNode(childrenDatas[i][0],data)}}if(bHassub){this._sTreeHtml+="</div>"}this._sTreeHtml+="</div>"};jDbank.ui.tree.prototype.appendNodeFromJSON=function(parentNode,jsonData,ifShow){if(!jsonData){return}if(typeof(ifShow)=="undefined"){var ifShow=true}var dSubPar=parentNode.getElementsByTagName("div")[0];if(dSubPar){dSubPar.innerHTML=this.parseJSON(jsonData);if(!ifShow){dSubPar.style.display="none"}}else{dSubPar=document.createElement("div");dSubPar.className="subitem";parentNode.appendChild(dSubPar);dSubPar.innerHTML=this.parseJSON(jsonData);if(ifShow){dSubPar.style.display="block"}parentNode.getElementsByTagName("span")[0].className="ico opened"}for(var key in jsonData){this.data[key]=jsonData[key];this.data[key].id=key}this.parseHTML(dSubPar)};jDbank.ui.tree.prototype.appendNodeData=function(nodeId,nodeName,parentNodeId,ifHaveSubFolder){this.data[nodeId]={id:nodeId,name:nodeName,parentid:parentNodeId,havesubfolder:ifHaveSubFolder}};jDbank.ui.tree.prototype.isParent=function(parentObj,sunObj){if(!sunObj){return -1}sunObj=jDbank(sunObj);parentObj=jDbank(parentObj);var isFather=false;if(parentObj[0]&&parentObj[0].tagName&&parentObj[0].tagName.toLowerCase()=="body"){return true}while(sunObj[0]&&sunObj[0].tagName&&sunObj[0].tagName.toLowerCase()!="body"){if(sunObj.parent()[0]==parentObj[0]){isFather=true;break}sunObj=sunObj.parent()}return isFather};jDbank.ui.tree.prototype.isChild=function(sunObj,parentObj){if(!sunObj){return -1}sunObj=jDbank(sunObj);parentObj=jDbank(parentObj);var isSun=false;if(parentObj[0]&&parentObj[0].tagName&&parentObj[0].tagName.toLowerCase()=="body"){return true}while(sunObj[0]&&sunObj[0].tagName&&sunObj[0].tagName.toLowerCase()!="body"){if(sunObj.parent()[0]==parentObj[0]){isSun=true;break}sunObj=sunObj.parent()}return isSun};jDbank.ui.tree.prototype.getPath=function(selectedObj){if(!selectedObj){return[]}selectedObj=jDbank(selectedObj);var arrPath=new Array();while(selectedObj[0]&&selectedObj[0].className!=this.className){if(selectedObj.hasClass("item")){arrPath[arrPath.length]=selectedObj[0]}selectedObj=selectedObj.parent()}return arrPath.reverse()};jDbank.ui.tree.prototype.getDepth=function(selectedObj){if(!selectedObj){return 0}selectedObj=jDbank(selectedObj);var iDep=0;while(selectedObj[0]&&selectedObj[0].className!=this.className){if(selectedObj.hasClass("item")){iDep++}selectedObj=selectedObj.parent()}return iDep};jDbank.ui.tree.prototype.getParent=function(node,depth){if(this.getFolderId(node)==this.rootId||this.getDepth(node)<=depth){return node}while(node.parentNode){node=node.parentNode;if(node.tagName.toLowerCase()=="div"&&node.className=="item"&&this.getDepth(node)==depth){return node}}return null};jDbank.ui.tree.prototype.openNode=function(folderId){var dFolder=document.getElementById(this.idPre+folderId);var dSpans;var dSub;do{dSpans=dFolder.getElementsByTagName("span");if(jDbank(dSpans[0]).hasClass("closed")){jDbank(dSpans[0]).removeClass("closed");jDbank(dSpans[0]).addClass("opened")}jDbank(dSpans[1]).removeClass("fclosed");jDbank(dSpans[1]).addClass("fopened");dSub=dFolder.getElementsByTagName("div")[0];if(dSub){dSub.style.display="block"}}while(dFolder=jDbank(dFolder).parents("div.item")[0])};jDbank.ui.tree.prototype.closeNode=function(folderId){var dFolder=document.getElementById(this.idPre+folderId);var dSpans=dFolder.getElementsByTagName("span");if(jDbank(dSpans[0]).hasClass("opened")){jDbank(dSpans[0]).removeClass("opened");jDbank(dSpans[0]).addClass("closed")}jDbank(dSpans[1]).removeClass("fopened");jDbank(dSpans[1]).addClass("fclosed");var dSub=dFolder.getElementsByTagName("div")[0];if(dSub){dSub.style.display="none"}};jDbank.ui.tree.prototype.setFocusNode=function(folderObj,ifDelay,fromHistory){var obj=null,This=this,fun=null,dTemp;if(typeof(folderObj)=="number"||typeof(folderObj)=="string"){obj=jDbank("#"+this.idPre+folderObj).children("span.txt")}else{if(typeof(folderObj)=="object"){folderObj=jDbank(folderObj);if(folderObj.hasClass("txt")){obj=folderObj}else{if(folderObj.hasClass("item")){obj=folderObj.children("span.txt")}}}}if(!obj){return false}this._eventObj={};this._eventObj.type="beforeFocusNode";dTemp=this._selectFolder?this._selectFolder[0].parentNode:null;if(dTemp){dTemp.data=this.data[this.getFolderId(dTemp)]}this._eventObj.focusNode=dTemp;dTemp=obj[0].parentNode;dTemp.data=this.data[this.getFolderId(dTemp)];this._eventObj.currentNode=dTemp;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}if(this._selectFolder){this._selectFolder.removeClass("on");this._selectFolder.removeClass("blur")}if(!obj.hasClass("on")){obj.addClass("on")}window.currentFocusedDom=this.focusIndex;if(!ifDelay){this._eventObj={};this._eventObj.type="afterFocusNode";dTemp=this._selectFolder?this._selectFolder[0].parentNode:null;if(dTemp){dTemp.data=this.data[this.getFolderId(dTemp)]}this._eventObj.oldFocusNode=dTemp;dTemp=obj[0].parentNode;dTemp.data=this.data[this.getFolderId(dTemp)];this._eventObj.newFocusNode=dTemp;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}}else{clearTimeout(this._timer);this._timer=setTimeout(function(){This._eventObj={};This._eventObj.type="afterFocusNode";This._selectFolder[0].parentNode.data=This.data[This.getFolderId(This._selectFolder[0].parentNode)];This._eventObj.oldFocusNode=This._selectFolder[0].parentNode;dTemp=obj[0].parentNode;dTemp.data=This.data[This.getFolderId(dTemp)];This._eventObj.newFocusNode=dTemp;fun=This.getEventHandler(This._eventObj);if(!fun.apply(This,This.getHandlerArguments(This._eventObj))){return false}},this.hoverOpenDelay)}this._selectFolder=obj;if(!/MSIE 6.0/ig.test(navigator.appVersion)&&typeof(fromHistory)=="undefined"&&this._supportHistory){var args=Array.prototype.slice.call(arguments,0);args.unshift(this);jDbank.util.history_.logPre="folder";jDbank.util.logHistory.apply(arguments.callee,args)}};jDbank.ui.tree.prototype.moveNode=function(dragObj,moveToObj,ifCopy){var oTemp=jDbank(moveToObj),dSub,oClone;if(!ifCopy){var ifCopy=false}if(oTemp[0].tagName.toLowerCase()=="div"&&oTemp.hasClass("item")){oTemp=jDbank(oTemp[0].getElementsByTagName("span")[2]);if(!oTemp.hasClass("txt")){return}}var oDrag=jDbank(dragObj);if(oDrag[0].tagName.toLowerCase()=="div"&&oDrag.hasClass("item")){oDrag=jDbank(oDrag[0].getElementsByTagName("span")[2]);if(!oDrag.hasClass("txt")){return}}var oNext=oTemp.next(),oPrev=oTemp.prev(),oPrev2=oPrev.prev();var oParentFolder=oDrag.parent().parent();if(!ifCopy){if(oTemp.next()[0]){oTemp.next().append(oDrag.parent())}else{dSub=document.createElement("div");dSub.className="subitem";dSub.style.display="block";dSub.appendChild(oDrag.parent()[0]);oTemp.parent().append(dSub)}}else{oClone=oDrag.parent().clone();if(oTemp.next()[0]){oTemp.next().append(oClone)}else{dSub=document.createElement("div");dSub.className="subitem";dSub.style.display="block";dSub.appendChild(oClone[0]);oTemp.parent().append(dSub)}this._dragObj=oClone.children("span.txt")}this.setParentNodeId(dragObj,this.getNodeId(moveToObj));if(!oParentFolder[0].getElementsByTagName("div")[0]){oParentFolder.prev().prev().removeClass("fopened");oParentFolder.prev().prev().addClass("fclosed");oParentFolder.prev().prev().prev().removeClass("opened")}if(!oPrev2.hasClass("closed")){this.data[this.getNodeId(oTemp)].havesubfolder=1}if(!oPrev2.hasClass("opened")){oPrev2.removeClass("closed");oPrev2.addClass("opened")}if(!oPrev.hasClass("fopened")){oPrev.removeClass("fclosed");oPrev.addClass("fopened")}if(oNext[0]){oNext.css("display","block")}if(ifCopy){return oClone[0]}};jDbank.ui.tree.prototype.showFloatObj=function(obj,left,top){if(!obj){return}if(obj){obj=jDbank(obj)[0];obj.style.left=parseInt(left).toString().replace(/\D/ig,"")+"px";obj.style.top=parseInt(top).toString().replace(/\D/ig,"")+"px";if(obj.style.display!="block"){obj.style.display="block"}}};jDbank.ui.tree.prototype.setInputTextSelected=function(obj){if(!obj){return}obj=jDbank(obj)[0];if(obj.tagName.toLowerCase()!="input"&&obj.tagName.toLowerCase()!="textarea"){return}try{obj.focus();obj.select()}catch(e){}};jDbank.ui.tree.prototype.showFollowDiv=function(left,top){var dFollow=document.getElementById(this.followDivId);this.showFloatObj(dFollow,left,top)};jDbank.ui.tree.prototype.hideFollowDiv=function(){if(document.getElementById(this.followDivId)){document.getElementById(this.followDivId).style.top="-9999px"}};jDbank.ui.tree.prototype.setFollowTitle=function(txt){var dFollow=document.getElementById(this.followDivId);if(dFollow){dFollow.getElementsByTagName("h6")[0].innerHTML=txt}};jDbank.ui.tree.prototype.setFollowTip=function(txt){var dFollow=document.getElementById(this.followDivId);if(dFollow){dFollow.getElementsByTagName("p")[0].innerHTML=txt}};jDbank.ui.tree.prototype.setList=function(listArr,type){if(typeof(listArr)!="object"){return}var dFollow=document.getElementById(this.followDivId);var dUl,i=0,sHtml="";if(dFollow){dUl=dFollow.getElementsByTagName("ul")[0];if(type===0){for(i=0;i<listArr.length;i++){sHtml+='<li class="dtfolder"><strong>'+listArr[i]+"</strong></li>"}}else{if(type==1){for(i=0;i<listArr.length;i++){sHtml+='<li class="dtfile1">'+listArr[i]+"</li>"}}}dUl.innerHTML=sHtml}};jDbank.ui.tree.prototype.setAlterText=function(txt){if(document.getElementById(this.alterDivId+"input")){document.getElementById(this.alterDivId+"input").value=txt}};jDbank.ui.tree.prototype.getAlterText=function(){if(document.getElementById(this.alterDivId+"input")){return document.getElementById(this.alterDivId+"input").value.replace(/[^\u4e00-\u9fa5\w\.\(\)-]*/g,"")}};jDbank.ui.tree.prototype.showAlterInput=function(left,top){var dDiv=document.getElementById(this.alterDivId);var dInput=dDiv.getElementsByTagName("input")[0];var self=this;dInput.className="";dInput.style.width="";self.showFloatObj(dDiv,left,top);self.setInputTextSelected(dInput)};jDbank.ui.tree.prototype.hideAlterInput=function(obj){if(obj){obj=jDbank(obj)[0];obj.style.top="-9999px"}else{if(document.getElementById(this.alterDivId)){document.getElementById(this.alterDivId).style.top="-9999px"}}};jDbank.ui.tree.prototype.renameNode=function(){var dAlterDiv=document.getElementById(this.alterDivId);var folderId=this.getFolderId(),folderName=this.getFolderName(),newName=this.getAlterText();var fun=null,dTemp;if(dAlterDiv){if(parseInt(dAlterDiv.style.top.replace(/px/ig,""))>=0){if(this._alterType==2){this._eventObj.type="afterCreateNode";dTemp=this._selectFolder[0].parentNode;dTemp.data=this.data[this.getFolderId(dTemp)];this._eventObj.parentNode=dTemp;dTemp=this._newNode[0].parentNode;this._eventObj.newNode=dTemp;this._eventObj.nodeName=newName;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}}else{if(this._alterType==1){this._eventObj.type="afterRenameNode";dTemp=this._selectFolder?this._selectFolder[0].parentNode:null;if(dTemp){dTemp.data=this.data[this.getFolderId(dTemp)]}this._eventObj.renameNode=dTemp;this._eventObj.oldName=folderName;this._eventObj.newName=newName;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}}}newName=/MSIE/ig.test(navigator.appVersion)?newName.substr(0,this.maxNodeNameLength):newName;if(this._alterType==1){if(this._selectFolder[0]){this._selectFolder[0].style.visibility=""}}else{if(this._alterType==2){}}this.hideAlterInput(dAlterDiv)}this._alterType=0}};jDbank.ui.tree.prototype.appendNode=function(nodeId,parentNodeId,nodeName,ifHaveSun){var dNew=document.createElement("div");dNew.className="item";dNew.id=this.idPre+nodeId;if(ifHaveSun!=0){dNew.innerHTML='<span class="ico closed"></span>\n<span class="ico fclosed"></span>\n<span class="txt">'+nodeName+'</span><div class="subitem"></div>'}else{dNew.innerHTML='<span class="ico"></span>\n<span class="ico fclosed"></span>\n<span class="txt">'+nodeName+"</span>"}var dFolder=document.getElementById(this.idPre+parentNodeId);var dParent=dFolder.getElementsByTagName("div")[0];if(!dParent){dParent=document.createElement("div");dParent.className="subitem";dFolder.appendChild(dParent)}dParent.appendChild(dNew);this.data[nodeId]={parentid:parentNodeId,name:nodeName,havesubfolder:ifHaveSun};return dNew};jDbank.ui.tree.prototype.createNode=function(parentFolderId,ifFirst){var dFolder=document.getElementById(this.idPre+parentFolderId);var dParent=dFolder.getElementsByTagName("div")[0];var oPos,folderObj;var dTemp,fun;this._eventObj={};this._eventObj.type="beforeCreateNode";dTemp=this._selectFolder[0].parentNode;dTemp.data=this.data[this.getFolderId(dTemp)];this._eventObj.parentNode=dTemp;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}var dNew=document.createElement("div");dNew.className="item";dNew.id=this.idPre+"0";dNew.innerHTML='<span class="ico"></span>\n<span class="ico fclosed"></span>\n<span class="txt">新建文件夹</span>';if(!dParent){dParent=document.createElement("div");dParent.className="subitem";dParent.style.display="block";dFolder.appendChild(dParent);ifFirst=false}if(ifFirst&&dParent.getElementsByTagName("div")[0]){dParent.insertBefore(dNew,dParent.getElementsByTagName("div")[0])}else{dParent.appendChild(dNew)}this.setHaveSubFolder(jDbank(dFolder),1);this.openNode(parentFolderId);jDbank(dFolder.getElementsByTagName("span")[0]).addClass("opened");folderObj=jDbank(dNew.getElementsByTagName("span")[2]);oPos=folderObj.offset();oPos.left-=5;oPos.top-=4;this._newNode=folderObj;this._alterType=2;this.setAlterText("新建文件夹");this.showAlterInput(oPos.left+5,oPos.top+4)};jDbank.ui.tree.prototype.deleteNode=function(folderId,ifHide){var dFolder=document.getElementById(this.idPre+folderId);if(!dFolder){return}var dParent=dFolder.parentNode.parentNode;var sName=this.getFolderName(dFolder);var fun=null;var dSpans;this._eventObj={};this._eventObj.type="beforeDeleteNode";dFolder.data=this.data[this.getFolderId(dFolder)];this._eventObj.deleteNode=dFolder;this._eventObj.ifHide=ifHide;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}if(this._selectFolder&&this._selectFolder.parent()[0]==dFolder){this._selectFolder=null}var oParentFolder=jDbank(dFolder.parentNode);if(!ifHide){dFolder.parentNode.removeChild(dFolder);delete this.data[this.getFolderId(dFolder)]}else{dFolder.style.display="none";dSpans=dFolder.getElementsByTagName("span");if(dSpans&&dSpans[2]){jDbank.util.removeClass(dSpans[2],"on");jDbank.util.removeClass(dSpans[2],"blur")}}this._eventObj.type="afterDeleteNode";dParent.data=this.data[this.getFolderId(dParent)];this._eventObj.deleteParentNode=dParent;this._eventObj.nodeId=folderId;this._eventObj.nodeName=sName;this._eventObj.ifHide=ifHide;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}};jDbank.ui.tree.prototype.openSubFolders=function(obj,ifRefresh){if(!obj){return}var oTemp=jDbank(obj);obj=oTemp[0];var dSub,folderId,parentFolderId,fun=null;var sType="";if(obj.tagName.toLowerCase()=="span"){obj=obj.parentNode;dSub=obj.getElementsByTagName("div")[0];if(oTemp.hasClass("closed")){sType="span.ico"}else{if(oTemp.hasClass("fclosed")||oTemp.hasClass("fopened")){sType="span.folder"}else{if(oTemp.hasClass("txt")){sType="span.txt"}}}}else{if(obj.tagName.toLowerCase()=="div"&&obj.className=="item"){dSub=obj.getElementsByTagName("div")[0];sType="div.item"}else{return}}folderId=this.getFolderId(obj);this._eventObj={};this._eventObj.type="beforeOpenNode";this._eventObj.subsReady=typeof(ifRefresh)=="undefined"?true:ifRefresh;if(dSub&&dSub.className=="subitem"){if(!dSub.getElementsByTagName("div")[0]&&jDbank(dSub).prev().prev().prev().hasClass("closed")){this._eventObj.subsReady=false}}obj.data=this.data[folderId];this._eventObj.openNode=obj;this._eventObj.openType=sType;this._eventObj.showObj=dSub?dSub:null;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}this.openNode(folderId);this._eventObj={};this._eventObj.type="afterOpenNode";obj.data=this.data[folderId];this._eventObj.openNode=obj;this._eventObj.openType=sType;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}};jDbank.ui.tree.prototype.setFolderSelected=function(obj){if(!obj){return}obj=jDbank(obj);var oNext;if(obj.hasClass("txt")){oNext=obj}else{if(obj.hasClass("fclosed")||obj.hasClass("fopened")){oNext=obj.next()}}var folderId=this.getFolderId(obj);var lastFolderId=this.getFolderId(this._selectFolder);if(this._selectFolder){if(this.getParentFolderId(obj)==this.getParentFolderId(this._selectFolder)&&folderId!=lastFolderId){this.closeNode(lastFolderId)}}this.setFocusNode(folderId,false)};jDbank.ui.tree.prototype.maininit=function(module,This){var self=This||this;var dTar,oTemp;jDbank(module).bind("mouseup",function(e){dTar=e.target;oTemp=jDbank(dTar);if(!self._isMoving&&e.button!=2){if(dTar.tagName.toLowerCase()=="em"&&dTar.parentNode.tagName.toLowerCase()=="span"){dTar=dTar.parentNode;oTemp=jDbank(dTar)}if(dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("opened")&&self._alterType==0){self.closeNode(self.getFolderId(oTemp))}else{if(dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("closed")&&self._alterType==0){self.openSubFolders(dTar)}else{if(dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("fopened")&&self._alterType==0){self.openSubFolders(dTar);self.setFolderSelected(oTemp)}else{if(dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("fclosed")&&self._alterType==0){self.openSubFolders(dTar);self.setFolderSelected(oTemp)}else{if(dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("txt")&&self._alterType==0){if(oTemp.prev().hasClass("fclosed")){self.openSubFolders(dTar)}self.setFolderSelected(oTemp)}else{if(dTar.tagName.toLowerCase()=="div"&&oTemp.hasClass("item")&&self._alterType==0){if(oTemp.children("span.fclosed")){self.openSubFolders(dTar)}self.setFolderSelected(oTemp)}}}}}}}})};jDbank.ui.tree.prototype.startDrag=function(dragObj,dragType){this._dragType=dragType||0;this._startMove=true;this._dragObj=jDbank(dragObj)};jDbank.ui.tree.prototype.draginit=function(module,This){var self=This||this;var dTar,oTemp,oModule;var timer=null,dSub,_dragDelay=null;var oParent,fun=null,dTemp;oModule=jDbank(module);oModule.bind("mousedown",function(e){if(e.button==2||(document.all&&e.button==0)){return}dTar=e.target;if(self._alterType==0&&dTar.tagName.toLowerCase()=="span"&&jDbank(dTar).hasClass("txt")&&self.isParent(self._treeObj,dTar)){if(!self._dragObj){self._dragObj=self._selectFolder?self._selectFolder:null}if(self._dragObj){self._dragObj.removeClass("on");self._dragObj.removeClass("blur")}self._dragType=0;if(_dragDelay){clearTimeout(_dragDelay)}_dragDelay=setTimeout(function(){self._startMove=true},self._dragDelayTime);self._dragObj=jDbank(dTar);self.setList([self._dragObj.text()],0)}if(dTar.tagName.toLowerCase()!="input"&&dTar.tagName.toLowerCase()!="textarea"&&dTar.tagName.toLowerCase()!="object"&&dTar.tagName.toLowerCase()!="select"){e.preventDefault()}});oModule.bind("mousemove",function(e){if(e.button!=2&&self._startMove){jDbank(self._treeObj).children().addClass("dbtreemove");self._isMoving=true;self.showFollowDiv(e.pageX+6,e.pageY+13);e.preventDefault()}});oModule.bind("mouseover",function(e){dTar=e.target;oTemp=jDbank(dTar);if(!self.isChild(dTar,self._treeObj)){return}if(dTar.tagName.toLowerCase()=="div"&&oTemp.hasClass("item")){oTemp=oTemp.children("span.txt");dTar=oTemp[0]}else{if(dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("ico")&&!oTemp.hasClass("txt")){oTemp=oTemp.parent().children("span.txt");dTar=oTemp[0]}}if(self._isMoving&&dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("txt")){if(self._overObj){self._overObj.removeClass("on");self._overObj.removeClass("blur")}oTemp.addClass("on");self._overObj=oTemp;dSub=oTemp[0].parentNode.getElementsByTagName("div")[0];if(self._dragType!==0||(!self.isParent(self._dragObj.parent(),self._overObj.parent())&&self.getFolderId(self._dragObj)!=self.getFolderId(self._overObj)&&dSub&&dSub.className=="subitem")){timer=setTimeout(function(){self.openSubFolders(oTemp)},self.hoverOpenDelay)}}else{if(timer){clearTimeout(timer)}}});jDbank(self._treeObj).bind("mouseout",function(e){dTar=e.target;oTemp=jDbank(dTar);if(self._isMoving&&dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("txt")){oTemp.removeClass("on");oTemp.removeClass("blur");self._overObj=null}if(timer){clearTimeout(timer)}});var fnDragOk=function(){self.hideFollowDiv();jDbank(self._treeObj).children().removeClass("dbtreemove");self._startMove=false;self._isMoving=false};oModule.bind("mouseup",function(e){if(e.button==2||(document.all&&e.button==0)){return false}dTar=e.target;oTemp=jDbank(dTar);oParent=oTemp.parent();if(_dragDelay){clearTimeout(_dragDelay)}if(self._overObj){self._overObj.removeClass("on");self._overObj.removeClass("blur");self._overObj=null}if(dTar.tagName.toLowerCase()=="div"&&oTemp.hasClass("item")){oParent=oTemp;oTemp=oTemp.children("span.txt");dTar=oTemp[0]}else{if(dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("ico")&&!oTemp.hasClass("txt")){oTemp=oParent.children("span.txt");dTar=oTemp[0]}}if(self.isChild(dTar,self._treeObj)&&dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("txt")&&oParent.hasClass("item")){if(self._isMoving&&self._dragType===0){if(self.getFolderId(self._dragObj)!=self.getFolderId(oTemp)&&self._dragObj.parent().parent().parent().attr("id")!=oParent.attr("id")&&!self.isParent(self._dragObj.parent(),oTemp)){if(self._selectFolder){self._selectFolder.removeClass("on");self._selectFolder.removeClass("blur")}self._selectFolder=self._dragObj;self._moveToObj=oTemp;self._eventObj={};self._eventObj.event=e;self._eventObj.type="beforeDragNode";dTemp=self._dragObj[0].parentNode;dTemp.data=self.data[self.getFolderId(self._dragObj)];self._eventObj.dragNode=dTemp;self._eventObj.dragNodeName=self.getFolderName(self._dragObj);dTemp=self._moveToObj[0].parentNode;dTemp.data=self.data[self.getFolderId(self._moveToObj)];self._eventObj.targetNode=dTemp;self._eventObj.targetNodeName=self.getFolderName(self._moveToObj);fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){fnDragOk();return false}if(!e.ctrlKey){self.moveNode(self._dragObj,oTemp);self._eventObj.copy=false}else{self._eventObj.copyNode=self.moveNode(self._dragObj,oTemp,true);self._eventObj.copy=true}self._eventObj.type="afterDragNode";fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){fnDragOk();return false}self.setFocusNode(self.getFolderId(self._dragObj),false)}else{if(self._selectFolder&&self._selectFolder.hasClass("txt")){self._selectFolder.addClass("on")}}}else{if(self._isMoving&&self._dragType===1){self._eventObj={};self._eventObj.event=e;self._eventObj.type="afterDragItem";self._eventObj.dragNode=self._dragObj[0];self._eventObj.targetNode=oTemp[0].parentNode;self._eventObj.targetNode.data=self.data[self.getFolderId(oTemp)];fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){fnDragOk();return false}if(self._selectFolder){self._selectFolder.addClass("on")}}}}else{if(window.currentFocusedDom==self.focusIndex){if(self._selectFolder&&self._selectFolder.hasClass("txt")){self._selectFolder.addClass("on")}}}fnDragOk();if(dTar.tagName.toLowerCase()!="input"&&dTar.tagName.toLowerCase()!="textarea"&&dTar.tagName.toLowerCase()!="object"){e.preventDefault()}})};jDbank.ui.tree.prototype.readyRename=function(obj,This){var self=This||this;var oTemp=jDbank(obj),dTemp;if(obj.tagName.toLowerCase()=="div"&&oTemp.hasClass("item")){oTemp=oTemp.children("span.txt")}var oPos=oTemp.offset();oPos.left-=5;oPos.top-=4;self._eventObj={};self._eventObj.type="beforeRenameNode";dTemp=self._selectFolder?self._selectFolder[0].parentNode:null;if(dTemp){dTemp.data=self.data[self.getFolderId(dTemp)]}self._eventObj.renameNode=dTemp;fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}self._alterType=1;self.setAlterText(self.getFolderName(oTemp));oTemp[0].style.visibility="hidden";if(jDbank.browser.msie&&jDbank.browser.version==6){self.showAlterInput(oPos.left+4,oPos.top+4)}else{self.showAlterInput(oPos.left+5,oPos.top+4)}var dAlterInput=document.getElementById(self.alterDivId+"input");if(dAlterInput){dAlterInput.style.width=(oTemp.width()>40?(oTemp.width()+10):40)+"px"}};jDbank.ui.tree.prototype.renameinit=function(module,This){var self=This||this;var oModule=jDbank(module);var dTar,oTemp,oPos,dTemp;var dAlterDiv=document.getElementById(self.alterDivId);var dAlterInput=dAlterDiv.getElementsByTagName("input")[0];oModule.bind("dblclick",function(e){if(jDbank.data.getGlobal("tree").data[getShareRootId(self.getFolderId())].sUid == jDbank.data.getGlobal("sessionuserid")){dTar=e.target;oTemp=jDbank(dTar);if(dTar.tagName.toLowerCase()=="em"&&dTar.parentNode.tagName.toLowerCase()=="span"){dTar=dTar.parentNode;oTemp=jDbank(dTar)}if(dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("txt")){self.readyRename(dTar,self)}e.preventDefault()}});jDbank(dAlterInput).bind("keydown",function(e){if(self._alterType>0){if(e.keyCode==13){self.renameNode();e.preventDefault()}else{if(e.keyCode==27){if(self._alterType==2){self._eventObj={};self._eventObj.type="beforeCancelCreate";fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}oTemp=self._newNode[0].parentNode.parentNode;oTemp.removeChild(self._newNode[0].parentNode);if(!oTemp.getElementsByTagName("div")[0]){jDbank(oTemp.parentNode.getElementsByTagName("span")[0]).removeClass("opened");self.data[self.getFolderId(oTemp.parentNode)]["havesubfolder"]=0}}else{if(self._alterType==1){self._eventObj={};self._eventObj.type="beforeCancelRename";fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}if(self._selectFolder[0]){self._selectFolder[0].style.visibility=""}}}self.hideAlterInput();self._alterType=0}}}})};jDbank.ui.tree.prototype.keyListener=function(module,This){var self=This||this;var oModule=jDbank(module);var dTar,oTemp;var iFocus=0;var fnSetFirstFolderFocus=function(){if(!self._selectFolder){self.setFocusNode(self.getRootId(),true);return true}return false};var fnUporDown=function(ifUp){var oTemp,oNext,oPrev;oTemp=self._selectFolder.parent();if(!ifUp){if(oTemp.children("span.opened")[0]){oNext=jDbank(self._selectFolder.next().children("div.item").get(0))}else{oNext=oTemp.next()}if(oNext[0]){self.setFocusNode(oNext,true)}else{oNext=oTemp.parents("div.item").next();if(oNext[0]){self.setFocusNode(jDbank(oNext[0]),true)}else{return}}}else{if(oTemp.prev().children("span.opened")[0]){oPrev=oTemp.prev().children("div.subitem").children("div.item").get();oPrev=jDbank(oPrev[oPrev.length-1]);while(jDbank(oPrev[0].getElementsByTagName("span")[0]).hasClass("opened")){oPrev=oPrev.children("div.subitem").children("div.item").get();oPrev=jDbank(oPrev[oPrev.length-1])}oPrev=jDbank(oPrev)}else{oPrev=oTemp.prev()}if(oPrev[0]){self.setFocusNode(oPrev,true)}else{oPrev=oTemp.parents("div.item");if(oPrev[0]){self.setFocusNode(jDbank(oPrev[0]),true)}else{return}}}};oModule.bind("keydown",function(e){if(typeof(currentFocusedDom)!="undefined"){iFocus=window.currentFocusedDom}if(iFocus==self.focusIndex&&self._alterType===0){if(e.keyCode==37){if(!fnSetFirstFolderFocus()){if(self._selectFolder.prev().prev().hasClass("opened")){self.closeNode(self.getFolderId())}else{oTemp=self._selectFolder.parent().parents("div.item").get(0);if(oTemp){self._selectFolder.removeClass("on");self._selectFolder.removeClass("blur");self._selectFolder=jDbank(oTemp).children("span.txt");self._selectFolder.addClass("on")}else{return}}}e.preventDefault()}else{if(e.keyCode==38){if(!fnSetFirstFolderFocus()){fnUporDown(true)}e.preventDefault()}else{if(e.keyCode==39){if(!fnSetFirstFolderFocus()){if(self._selectFolder.prev().prev().hasClass("closed")){self.openSubFolders(self._selectFolder)}else{if(self._selectFolder.prev().prev().hasClass("opened")){oTemp=self._selectFolder.next().children("div.item").get(0);if(oTemp){self._selectFolder.removeClass("on");self._selectFolder.removeClass("blur");self._selectFolder=jDbank(oTemp).children("span.txt");self._selectFolder.addClass("on")}else{return}}else{return}}}e.preventDefault()}else{if(e.keyCode==40){if(!fnSetFirstFolderFocus()){fnUporDown()}e.preventDefault()}else{if(e.keyCode==113&&self._selectFolder){self.readyRename(self.getSelectedNode(),self)}}}}}}});oModule.bind("click",function(e){dTar=e.target;if(self._alterType>0&&dTar.tagName.toLowerCase()!="input"&&dTar.tagName.toLowerCase()!="a"){self.renameNode();e.preventDefault()}});oModule.bind("mouseup",function(e){dTar=e.target;oTemp=jDbank(dTar.parentNode);if(e.button!=2&&self._alterType==0&&!self.isChild(dTar,self._treeObj)){if(self._selectFolder&&((dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("item")&&!jDbank(dTar).hasClass("closed")&&!jDbank(dTar).hasClass("opened"))||(dTar.tagName.toLowerCase()=="div"&&jDbank(dTar).hasClass("item"))||(dTar.tagName.toLowerCase()=="em"&&dTar.parentNode.tagName.toLowerCase()=="span"&&oTemp.hasClass("txt")))){self._selectFolder.removeClass("on");self._selectFolder.removeClass("blur")}else{if(self._selectFolder&&window.currentFocusedDom&&window.currentFocusedDom==self.focusIndex){self._selectFolder.addClass("blur")}}}});oModule.bind("mousedown",function(e){dTar=e.target;oTemp=jDbank(dTar.parentNode);if((e.button==2||(document.all&&e.button==0))&&self._alterType==0&&!self.isChild(dTar,self._treeObj)){if(self._selectFolder&&((dTar.tagName.toLowerCase()=="span"&&oTemp.hasClass("item")&&!jDbank(dTar).hasClass("closed")&&!jDbank(dTar).hasClass("opened"))||(dTar.tagName.toLowerCase()=="div"&&jDbank(dTar).hasClass("item"))||(dTar.tagName.toLowerCase()=="em"&&dTar.parentNode.tagName.toLowerCase()=="span"&&oTemp.hasClass("txt")))){self._selectFolder.removeClass("on");self._selectFolder.removeClass("blur")}}})};jDbank.ui.tree.prototype.rightmenuinit=function(module,This){var self=This||this;var dTar,dWin=document.getElementById(self._rightMenuDivId),fun;jDbank(module).bind("mousedown",function(e){dTar=e.target;if(e.button==2||(document.all&&e.button==0)){module.oncontextmenu=function(){return false};if(dTar.tagName.toLowerCase()=="div"&&dTar.className=="item"){self.setFocusNode(self.getFolderId(dTar),false)}else{if(dTar.tagName.toLowerCase()=="span"&&(jDbank(dTar).hasClass("txt")||jDbank(dTar).hasClass("ico"))){dTar=dTar.parentNode;self.setFocusNode(self.getFolderId(dTar),false)}else{if(dTar.tagName.toLowerCase()=="em"&&dTar.parentNode.tagName.toLowerCase()=="span"&&(jDbank(dTar.parentNode).hasClass("txt")||jDbank(dTar.parentNode).hasClass("ico"))){dTar=dTar.parentNode.parentNode;self.setFocusNode(self.getFolderId(dTar),false)}}}self._eventObj={};self._eventObj.type="beforeShowRightMenu";if(dTar){dTar.data=self.data[self.getFolderId(dTar)]}self._eventObj.clickNode=dTar?dTar:null;fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}if(dWin){dWin.style.left=(e.pageX+2)+"px";dWin.style.top=(e.pageY+2)+"px";dWin.style.display="block"}e.preventDefault()}else{if(e.button==1||e.button==0){if(dWin&&dWin.style.display=="block"){dWin.style.display="none"}}}})};jDbank.ui.tree.prototype.destroy=function(){this._selectFolder=null;this._newNode=null;this._startMove=false;this._isMoving=false;this._dragType=0;this._dragObj=null;this._overObj=null;this._moveToObj=null;this._alterType=0;this._timer=null;this._sTreeHtml="";this.data={}};jDbank.ui.tree.prototype.refresh=function(){this._selectFolder=null;this._newNode=null;this._startMove=false;this._isMoving=false;this._dragType=0;this._dragObj=null;this._overObj=null;this._moveToObj=null;this._alterType=0;this._timer=null;this._sTreeHtml="";this.data={}};jDbank.ui.tree.prototype.bindevent=function(treeId){var module=document.getElementById(treeId);this._treeObj=module;this.maininit(module,this);if(this._supportDrag){this.draginit(document,this)}if(this._supportRename){this.renameinit(module,this)}if(this._supportKeyboard){this.keyListener(document,this)}if(this._supportRightMenu){this.rightmenuinit(module,this)}};jDbank.ui.tree.prototype.init=function(treeId,data){var This=this;var module=document.getElementById(treeId);this._treeObj=module;var dRoot=module.getElementsByTagName("div")[0];var fun=null;if(typeof(data)!="undefined"){this.data=jDbank.util.clone(data);this.makeTreeNode(this.rootId,data);dRoot.innerHTML=this._sTreeHtml}else{if(this.dataUrl!==""){jDbank.getJSON(this.dataUrl,function(data){This.data=jDbank.util.clone(data);This.makeTreeNode(This.rootId,data);dRoot.innerHTML=This._sTreeHtml})}else{this.parseHTML(dRoot)}}this._eventObj={};this._eventObj.type="fillComplete";fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}}})();var miniYUI={stopEvent:function(a){this.stopPropagation(a);this.preventDefault(a)},stopPropagation:function(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}},preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},getEvent:function(d,a){var b=d||window.event;if(!b){var f=this.getEvent.caller;while(f){b=f.arguments[0];if(b&&Event==b.constructor){break}f=f.caller}}return b},getTarget:function(c,b){var a=c.target||c.srcElement;return this.resolveTextNode(a)},resolveTextNode:function(b){try{if(b&&3==b.nodeType){return b.parentNode}}catch(a){}return b},on:function(){if(window.addEventListener){return function(c,d,b,a){c.addEventListener(d,b,(a))}}else{if(window.attachEvent){return function(c,d,b,a){c.attachEvent("on"+d,b)}}else{return function(){}}}}(),hasClass:function(b,a){return a&&(" "+b.className+" ").indexOf(" "+a+" ")>-1},addClass:function(b,a){if(b.className===""){b.className=a}else{if(b.className!==""&&!this.hasClass(b,a)){b.className=b.className+" "+a}}},removeClass:function(b,a){if(this.hasClass(b,a)){b.className=(" "+b.className+" ").replace(" "+a+" "," ").replace(/^ | $/g,"")}},getElementsByClassName:function(f,b,c){if(!c){return[]}var d=[],g=c.getElementsByTagName(b);for(var e=0,a=g.length;e<a;e++){if(this.hasClass(g[e],f)){d[d.length]=g[e]}}return d},getPreviousSibling:function(a){while(a){a=a.previousSibling;if(a&&a.nodeType==1){return a}}return null},getNextSibling:function(a){while(a){a=a.nextSibling;if(a&&a.nodeType==1){return a}}return null},getPosition:function(){return document.documentElement.getBoundingClientRect&&function(b){var c=b.getBoundingClientRect(),a=b.ownerDocument||b.document;return{left:c.left+a.documentElement.scrollLeft,top:c.top+a.documentElement.scrollTop}}||function(b){var a=0,c=0;do{a+=b.offsetLeft;c+=b.offsetTop}while((b=b.offsetParent));return{left:a,top:c}}}(),getXY:function(a){return{x:a.pageX?a.pageX+4:a.clientX+document.documentElement.scrollLeft,y:a.pageY?a.pageY+4:a.clientY+document.documentElement.scrollTop}},isChild:function(c,b){if(!c||!b){return}var a=false;if(b.tagName&&b.tagName.toLowerCase()=="body"){return true}while(c&&c.tagName&&c.tagName.toLowerCase()!="body"){if(c.parentNode==b){a=true;break}c=c.parentNode}return a},clone:function(b){if(typeof(b)!="object"){return null}var c={};if(!b.length){for(key in b){c[key]=b[key]}}else{c=[];for(var a=0;a<b.length;a++){c[a]=b[a]}}return c},doWhileExist:function(c,b){var a=Array.prototype.slice.call(arguments,2);var d=document.getElementById(c);if(d){a.unshift(d);b.apply(null,a)}}};(function(){jDbank.ui.object=function(b){this._data={};this._eventObj={};this._eventMap={};this._argumentsMap={};this._eventType={};this.data={};this.dataUrl="";this.idPre=""};var a=jDbank.ui.object;a.prototype.set=function(b,c){this._data[b]=c};a.prototype.get=function(b){return typeof(this._data[b])!="undefined"?this._data[b]:undefined};a.prototype.getAlter=function(){var b=document.getElementById(this._data.alterId);if(b){return b}b=document.createElement("div");b.id=this._data.alterId;b.style.position="absolute";b.style.zIndex="1001";b.innerHTML='<input type="text" value="'+this._data.alterDefaultText+'" />';document.body.appendChild(b);return b};a.prototype.bind=function(c,b){if(typeof(b)!="function"){return}this._eventMap[c]=b;this._argumentsMap[c]=Array.prototype.slice.call(arguments,2)};a.prototype.getHandler=function(b){return typeof(this._eventMap[b])!="undefined"?this._eventMap[b]:function(){return true}};a.prototype.getHandlerArguments=function(c){var b=new Array(c);return typeof(this._argumentsMap[c.type])!="undefined"?b.concat(this._argumentsMap[c.type]):b};a.prototype.getHandlerType=function(){var b=new Array();for(key in this._eventType){b[b.length]=key}return b}})();(function(){var a=miniYUI;jDbank.ui.list=function(b){jDbank.ui.object.call(this,b);this._data={id:b,dUl:document.getElementById(b)?document.getElementById(b):null,focusedNode:null,focusClass:"on",sLastInnerHtml:"",defaultNewNodeId:"jul_newlist",alterType:0,alterId:"dbalter",alterDefaultText:"新分组",timer:null,focusAfterDelay:500,rightmenuId:"dblistmenu",dRightmenu:null,focusIndex:-1,maxlength:11};this._eventType={beforeFocusNode:"beforeFocusNode",afterFocusNode:"afterFocusNode",beforeCreateNode:"beforeCreateNode",afterCreateNode:"afterCreateNode",beforeRenameNode:"beforeRenameNode",afterRenameNode:"afterRenameNode",afterCancelRename:"afterCancelRename",beforeDeleteNode:"beforeDeleteNode",afterDeleteNode:"afterDeleteNode",afterCancelAdd:"afterCancelAdd",beforeShowRightMenu:"beforeShowRightMenu"}};jDbank.ui.list.prototype=new jDbank.ui.object();jDbank.ui.list.prototype.readyAddNode=function(g){var f=null;if(typeof(g)=="object"){f=g}else{if(typeof(g)=="number"){f=typeof(this.data[this.idPre+g])!="undefined"?this.data[this.idPre+g]:document.getElementById(this.idPre+g)}}var d=f?f.id.replace(this.idPre,""):"";this._eventObj={};this._eventObj.type=this._eventType.beforeCreateNode;this._eventObj.beforeNode=f;this._eventObj.beforeNodeId=d;var b=this.getHandler(this._eventType.beforeCreateNode);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}this._data.alterType=2;var e=document.createElement("li");e.id=this._data.defaultNewNodeId;e.innerHTML='<em class="square"></em><a href="#">'+this._data.alterDefaultText+"</a>";if(this._eventObj.beforeNode){this._data.dUl.insertBefore(e,this._eventObj.beforeNode)}else{this._data.dUl.appendChild(e)}this.setFocus(e);var i=this.getAlter();var h=i.getElementsByTagName("input")[0];h.value=this._data.alterDefaultText;var c=a.getPosition(e.getElementsByTagName("a")[0]);if(document.all){c.top-=1}i.style.left=c.left+"px";i.style.top=c.top+"px";i.getElementsByTagName("input")[0].select()};jDbank.ui.list.prototype.cancelAddNode=function(){var d=document.getElementById(this._data.defaultNewNodeId);var c;if(this._data.alterType==1){this.getAlter().style.top="-9999px";this._data.focusedNode.getElementsByTagName("a")[0].innerHTML=this._data.sLastInnerHtml;c=this._data.focusedNode.getElementsByTagName("a")[0];this._eventObj={};this._eventObj.type=this._eventType.afterCancelRename;this._eventObj.renameNode=this._data.focusedNode;var b=this.getHandler(this._eventType.afterCancelRename);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}if(c){c.style.visibility=""}}else{if(d&&this._data.alterType==2){this._data.dUl.removeChild(d);this.getAlter().style.top="-9999px";this._eventObj={};this._eventObj.type=this._eventType.afterCancelAdd;var b=this.getHandler(this._eventType.afterCancelAdd);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}}}this._data.alterType=0};jDbank.ui.list.prototype.readyRenameNode=function(i){var f=null;if(typeof(i)=="object"){f=i}else{if(typeof(i)=="number"){f=typeof(this.data[this.idPre+i])!="undefined"?this.data[this.idPre+i]:document.getElementById(this.idPre+i)}}if(!f){return}var e=f.id.replace(this.idPre,"");var c=f.getElementsByTagName("a")[0];this._eventObj={};this._eventObj.type=this._eventType.beforeRenameNode;this._eventObj.renameNode=f;this._eventObj.nodeId=e;var b=this.getHandler(this._eventType.beforeRenameNode);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}this._data.alterType=1;var h=this.getAlter();var g=h.getElementsByTagName("input")[0];var d=a.getPosition(c);if(document.all){d.top-=1}h.style.left=d.left+"px";h.style.top=d.top+"px";g.value=c.innerHTML.replace(/[^\u4e00-\u9fa5\w\.\(\)-]*/g,"").substr(0,this._data.maxlength);this._data.sLastInnerHtml=g.value;c.style.visibility="hidden";g.style.width=f.offsetWidth*0.8+"px";g.select()};jDbank.ui.list.prototype.renameNode=function(h,c){c=c.replace(/[^\u4e00-\u9fa5\w\.\(\)-]*/g,"").substr(0,this._data.maxlength);var g=null;if(typeof(h)=="object"){g=h}else{if(typeof(h)=="number"){g=typeof(this.data[this.idPre+h])!="undefined"?this.data[this.idPre+h]:document.getElementById(this.idPre+h)}}if(!g){return}var f=g.id.replace(this.idPre,"");var d=g.getElementsByTagName("a")[0];var e="";if(d){e=this._data.sLastInnerHtml}if(this._data.alterType==1){this._eventObj={};this._eventObj.type=this._eventType.afterRenameNode;this._eventObj.node=g;this._eventObj.nodeId=f;this._eventObj.newName=c;this._eventObj.oldName=e;var b=this.getHandler(this._eventType.afterRenameNode);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}}else{if(this._data.alterType==2){this._eventObj={};this._eventObj.type=this._eventType.afterCreateNode;this._eventObj.node=g;this._eventObj.nodeName=c;var b=this.getHandler(this._eventType.afterCreateNode);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}}}if(d){d.innerHTML=c;d.style.visibility=""}this._data.alterType=0;this.getAlter().style.top="-9999px"};jDbank.ui.list.prototype.deleteNode=function(f){var d=null;if(typeof(f)=="object"){d=f}else{if(typeof(f)=="number"){d=typeof(this.data[this.idPre+f])!="undefined"?this.data[this.idPre+f]:document.getElementById(this.idPre+f)}}if(!d){return}var c=d.id.replace(this.idPre,"");var e=d.getElementsByTagName("a")[0]?d.getElementsByTagName("a")[0].innerHTML:"";this._eventObj={};this._eventObj.type=this._eventType.beforeDeleteNode;this._eventObj.deleteNode=d;this._eventObj.nodeId=c;var b=this.getHandler(this._eventType.beforeDeleteNode);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}this._eventObj={};this._eventObj.type=this._eventType.afterDeleteNode;this._eventObj.nodeName=e;this._eventObj.nodeId=c;var b=this.getHandler(this._eventType.afterDeleteNode);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}};jDbank.ui.list.prototype.setFocus=function(e){var d=null;if(typeof(e)=="object"){d=e}else{if(typeof(e)=="number"){d=typeof(this.data[this.idPre+e])!="undefined"?this.data[this.idPre+e]:document.getElementById(this.idPre+e)}}if(!d){return}this._eventObj={};this._eventObj.type=this._eventType.beforeFocusNode;this._eventObj.oldFocusedNode=this._data.focusedNode;this._eventObj.newFocusedNode=d;var b=this.getHandler(this._eventType.beforeFocusNode);if(!b.apply(this,this.getHandlerArguments(this._eventObj))){return false}if(this._data.focusedNode){a.removeClass(this._data.focusedNode,this._data.focusClass)}this._data.focusedNode=d;a.addClass(d,this._data.focusClass);window.currentFocusedDom=this._data.focusIndex;if(this._data.alterType>0){return}var c=this,b=this.getHandler(this._eventType.afterFocusNode);if(this._data.timer){clearTimeout(this._data.timer)}this._data.timer=setTimeout(function(){c._eventObj={};c._eventObj.type=c._eventType.afterFocusNode;c._eventObj.focusedNode=d;if(!b.apply(c,c.getHandlerArguments(c._eventObj))){return false}},this._data.focusAfterDelay)};jDbank.ui.list.prototype.unFocus=function(c){var b=typeof(this.data[this.idPre+c])!="undefined"?this.data[this.idPre+c]:document.getElementById(this.idPre+c);if(!b){return}a.removeClass(b,this._data.focusClass)};jDbank.ui.list.prototype.appendNodeFromData=function(d){if(typeof(d)!="object"||!d.length){return}var c=document.createDocumentFragment();var e;var b=0;for(b=0;b<d.length;b++){if(typeof(this.data[this.idPre+d[b].id])=="undefined"){e=document.createElement("li");e.id=this.idPre+d[b].id;e.innerHTML=d[b].innerHTML;c.appendChild(e);this.data[e.id]=e}}if(c.innerHTML!==""){this._data.dUl.appendChild(c)}};jDbank.ui.list.prototype.parseHtml=function(b){if(!b){return}var d=b.getElementsByTagName("li");var c=0;for(c=0;c<d.length;c++){this.data[d[c].id]=d[c];if(d[c].className==this._data.focusClass){this._data.focusedNode=d[c]}}};jDbank.ui.list.prototype.appendToData=function(b){if(!b){return}this.data[b.id]=b};jDbank.ui.list.prototype.mouseListener=function(b){var j=b||this;var d,i,h;var g=function(l){d=a.getTarget(l);if(j._data.focusedNode&&j._data.alterType>0){j.renameNode(j._data.focusedNode,c.value)}if(d.tagName.toLowerCase()=="ul"){d=d.getElementsByTagName("li")[0]}else{if(d.tagName.toLowerCase()=="a"){d=d.parentNode;if(l.button==1||(!document.all&&l.button==0)){a.stopEvent(l)}}}j.setFocus(d);if(!j._data.dRightmenu){j._data.dRightmenu=document.getElementById(j._data.rightmenuId)?document.getElementById(j._data.rightmenuId):null}if(j._data.dRightmenu&&(l.button==2||(document.all&&l.button==0))){j._eventObj={};j._eventObj.type=j._eventType.beforeShowRightMenu;j._eventObj.focusedNode=d;h=j.getHandler(j._eventType.beforeShowRightMenu);if(!h.apply(j,j.getHandlerArguments(j._eventObj))){return false}if(j._data.dRightmenu.style.display!="block"){j._data.dRightmenu.style.display="block"}i=a.getXY(l);j._data.dRightmenu.style.left=i.x+"px";j._data.dRightmenu.style.top=i.y+"px"}};var f=function(l){d=a.getTarget(l);if(j._data.alterType==0&&d.tagName.toLowerCase()=="a"){a.stopEvent(l);d=d.parentNode;if(document.all){j.setFocus(d)}if(j._data.timer){clearTimeout(j._data.timer)}j.readyRenameNode(d)}};var c=this.getAlter().getElementsByTagName("input")[0];var e=function(l){d=a.getTarget(l);if(d.tagName.toLowerCase()!="a"&&d.tagName.toLowerCase()!="input"&&j._data.focusedNode&&j._data.alterType>0){j.renameNode(j._data.focusedNode,c.value)}};a.on(this._data.dUl,"mousedown",g);a.on(this._data.dUl,"dblclick",f);a.on(c,"blur",e);a.on(document,"click",e)};jDbank.ui.list.prototype.keyboardListener=function(f){var c=f||this;var d;var e=this.getAlter().getElementsByTagName("input")[0];var b=function(g){if(g.keyCode==13&&c._data.alterType>0){c.renameNode(c._data.focusedNode,e.value)}else{if(g.keyCode==27&&c._data.alterType>0){c.cancelAddNode()}}};a.on(document,"keypress",b)};jDbank.ui.list.prototype.init=function(b){if(typeof(b)=="object"){this.appendNodeFromData(b)}else{if(!b){this.parseHtml(this._data.dUl)}}this.mouseListener();this.keyboardListener()}})();(function(){var b=miniYUI;jDbank.ui.simpleTable=function(c){jDbank.ui.object.call(this,c);this._data={id:c,dTable:document.getElementById(c)?document.getElementById(c):null,dCheckboxs:null,focusedNode:null,focusClass:"selected",hoverClass:"on",alterType:0,alterId:"dbalter",alterDefaultText:"&nbsp;",focusIndex:-1}};jDbank.ui.simpleTable.prototype=new jDbank.ui.object();var a=jDbank.ui.simpleTable;a.prototype.getSelectedRows=function(f){var d=this._data.dCheckboxs?this._data.dCheckboxs:f.getElementsByTagName("input");var c=new Array();for(var e=0;e<d.length;e++){if(d[e]&&d[e].type=="checkbox"&&d[e].checked){c[c.length]=d[e].parentNode.parentNode}}return c};a.prototype.setFocus=function(d,c){var e;if(!d){return}if(d.tagName.toLowerCase()=="td"){d=d.parentNode}e=d.getElementsByTagName("input")[0];if(c){this._data.focusedNode=d;b.addClass(d,this._data.focusClass);e.checked=true}else{b.removeClass(d,this._data.focusClass);e.checked=false}window.currentFocusedDom=this._data.focusIndex};a.prototype.getCheckBoxs=function(f){var d=f.getElementsByTagName("input");var c=new Array();for(var e=0;e<d.length;e++){if(d[e]&&d[e].type=="checkbox"){c[c.length]=d[e]}}this._data.dCheckboxs=c;return c};a.prototype.selectAll=function(f,e){var c=this._data.dCheckboxs?this._data.dCheckboxs:f.getElementsByTagName("input");for(var d=0;d<c.length;d++){if(c[d]&&c[d].type=="checkbox"&&e){c[d].checked=true;b.addClass(c[d].parentNode.parentNode,this._data.focusClass)}else{if(c[d]&&c[d].type=="checkbox"&&!e){c[d].checked=false;b.removeClass(c[d].parentNode.parentNode,this._data.focusClass)}}}};a.prototype.hoverListener=function(e){var c=e||this;var d;b.on(this._data.dTable,"mouseover",function(f){d=b.getTarget(f);if(d.tagName.toLowerCase()=="div"&&d.parentNode.tagName.toLowerCase()=="td"){d=d.parentNode}if(d.tagName.toLowerCase()=="td"){b.addClass(d.parentNode,c._data.hoverClass)}else{if(d.tagName.toLowerCase()=="a"&&d.parentNode.tagName.toLowerCase()=="th"){b.addClass(d.parentNode,c._data.hoverClass)}else{if(d.tagName.toLowerCase()=="th"){b.addClass(d,c._data.hoverClass)}}}});b.on(this._data.dTable,"mouseout",function(f){d=b.getTarget(f);if(d.tagName.toLowerCase()=="div"&&d.parentNode.tagName.toLowerCase()=="td"){d=d.parentNode}if(d.tagName.toLowerCase()=="td"){b.removeClass(d.parentNode,c._data.hoverClass)}else{if(d.tagName.toLowerCase()=="a"&&d.parentNode.tagName.toLowerCase()=="th"){b.removeClass(d.parentNode,c._data.hoverClass)}else{if(d.tagName.toLowerCase()=="th"){b.removeClass(d,c._data.hoverClass)}}}})};a.prototype.clickListener=function(m){var e=m||this;var l,h=0,f=0,d=0,c,g;b.on(this._data.dTable,"click",function(i){l=b.getTarget(i);if(l.tagName.toLowerCase()=="div"&&l.parentNode.tagName.toLowerCase()=="td"){l=l.parentNode}if(l.tagName.toLowerCase()=="td"&&!b.hasClass(l,"checkboxs")){l=l.parentNode;if(i.ctrlKey){e.setFocus(l,true)}else{if(i.shiftKey){if(e._data.focusedNode){c=e._data.focusedNode.parentNode;if(e._data.focusedNode.rowIndex<l.rowIndex){f=e._data.focusedNode.rowIndex;d=l.rowIndex}else{f=l.rowIndex;d=e._data.focusedNode.rowIndex}for(h=f;h<d;h++){e.setFocus(c.rows[h],true)}}else{}e.setFocus(l,true)}else{e.selectAll(e._data.dTable,false);e.setFocus(l,true)}}}else{if(l.tagName.toLowerCase()=="input"&&l.type=="checkbox"&&l.parentNode.tagName.toLowerCase()=="td"){if(l.checked){e.setFocus(l.parentNode,true)}else{e.setFocus(l.parentNode,false)}}else{if(l.tagName.toLowerCase()=="input"&&l.type=="checkbox"&&l.parentNode.tagName.toLowerCase()=="th"){if(l.checked){e.selectAll(e._data.dTable,true)}else{e.selectAll(e._data.dTable,false)}}}}g=true;if(e._data.dCheckboxs){for(h=1;h<e._data.dCheckboxs.length;h++){if(e._data.dCheckboxs[h]&&!e._data.dCheckboxs[h].checked){g=false;break}}if(g){e._data.dCheckboxs[0].checked=true}else{e._data.dCheckboxs[0].checked=false}}})};a.prototype.keyListener=function(e){var c=e||this;var d;b.on(document,"keydown",function(f){if(window.currentFocusedDom==c._data.focusIndex&&f.ctrlKey&&f.keyCode==65){c.selectAll(c._data.dTable,true);b.stopEvent(f)}else{if(window.currentFocusedDom==c._data.focusIndex&&f.keyCode==38){if(!c._data.focusedNode){c.setFocus(c._data.dTable.rows[0],true);return}if(!f.ctrlKey&&!f.shiftKey){c.selectAll(c._data.dTable,false)}c.setFocus(b.getPreviousSibling(c._data.focusedNode),true);b.stopEvent(f)}else{if(window.currentFocusedDom==c._data.focusIndex&&f.keyCode==40){if(!c._data.focusedNode){c.setFocus(c._data.dTable.rows[c._data.dTable.rows.length-1],true);return}if(!f.ctrlKey&&!f.shiftKey){c.selectAll(c._data.dTable,false)}c.setFocus(b.getNextSibling(c._data.focusedNode),true);b.stopEvent(f)}}}})};a.prototype.refresh=function(){this._data.dTable=document.getElementById(this._data.id)?document.getElementById(this._data.id):null;this._data.focusedNode=null;this._data.alterType=0;this._data.dCheckboxs=null;this.getCheckBoxs(this._data.dTable)};a.prototype.init=function(){this.clickListener();this.keyListener();if(document.all){this._data.dTable.onselectstart=function(){return false};this.hoverListener()}this.getCheckBoxs(this._data.dTable)}})();(function(){var a=miniYUI;jDbank.ui.editable=function(c){jDbank.ui.simpleTable.call(this,c);this.filterClass=["group","checkboxs"];this._data.dLastTd=null;this._data.maxlength=100;this._eventType={beforeRenameNode:"beforeRenameNode",afterRenameNode:"afterRenameNode",afterCancelRename:"afterCancelRename"}};jDbank.ui.editable.prototype=new jDbank.ui.simpleTable();var b=jDbank.ui.editable;b.prototype.readyRenameCol=function(f){var h=this.getAlter(),e;var g=h.getElementsByTagName("input")[0];var d=f.getElementsByTagName("div")[0];this._eventObj={};this._eventObj.type=this._eventType.beforeRenameNode;this._eventObj.focusedNode=f;var c=this.getHandler(this._eventType.beforeRenameNode);if(!c.apply(this,this.getHandlerArguments(this._eventObj))){return false}this._data.alterType=1;this._data.dLastTd=f;g.value=d.innerHTML.replace(/&nbsp;/g,"").replace(/[^\u4e00-\u9fa5\w\.\(\)@-]*/g,"").substr(0,this._data.maxlength);this._data.dLastTd.lastValue=g.value;d.style.visibility="hidden";e=a.getPosition(f);h.style.left=e.left+8+"px";h.style.top=(e.top+1)+"px";g.style.width=f.offsetWidth*0.9+"px";g.select()};b.prototype.renameTheCol=function(){var f=this.getAlter();var e=f.getElementsByTagName("input")[0];var d=this._data.dLastTd.getElementsByTagName("div")[0];this._eventObj={};this._eventObj.type=this._eventType.afterRenameNode;this._eventObj.focusedNode=this._data.dLastTd;this._eventObj.lastValue=this._data.dLastTd.lastValue;this._eventObj.newValue=e.value.replace(/[^\u4e00-\u9fa5\w\.\(\)@-]*/g,"").substr(0,this._data.maxlength);var c=this.getHandler(this._eventType.afterRenameNode);if(!c.apply(this,this.getHandlerArguments(this._eventObj))){return false}d.innerHTML=this._eventObj.newValue!==""?this._eventObj.newValue:"&nbsp;";d.style.visibility="";f.style.top="-9999px";this._data.alterType=0};b.prototype.checkClassName=function(e){var c=this.filterClass;for(var d=0;d<c.length;d++){if(a.hasClass(e,c[d])){return false}}return true};b.prototype.dblclickListener=function(g){var c=g||this;var d,f=this.getAlter();var e=f.getElementsByTagName("input")[0];a.on(this._data.dTable,"dblclick",function(h){d=a.getTarget(h);if(d.tagName.toLowerCase()=="div"&&d.parentNode&&d.parentNode.tagName.toLowerCase()=="td"){d=d.parentNode}if(d.tagName.toLowerCase()=="td"&&c.checkClassName(d)){c.readyRenameCol(d)}});a.on(document,"click",function(h){d=a.getTarget(h);if(d.tagName.toLowerCase()!="input"&&window.currentFocusedDom==c._data.focusIndex&&c._data.alterType==1){c.renameTheCol()}})};b.prototype.editKeyListener=function(h){var c=h||this;var e,g=this.getAlter();var f=g.getElementsByTagName("input")[0];var d;a.on(document,"keydown",function(j){if(window.currentFocusedDom==c._data.focusIndex&&c._data.alterType==1){if(j.keyCode==13){c.renameTheCol()}else{if(j.keyCode==27){g.style.top="-9999px";c._data.alterType=0;c._data.dLastTd.getElementsByTagName("div")[0].innerHTML=c._data.dLastTd.lastValue!=""?c._data.dLastTd.lastValue:"&nbsp;";d=c._data.dLastTd.getElementsByTagName("div")[0];c._eventObj={};c._eventObj.type=c._eventType.afterCancelRename;c._eventObj.focusedNode=c._data.dLastTd;var i=c.getHandler(c._eventType.afterCancelRename);if(!i.apply(c,c.getHandlerArguments(c._eventObj))){return false}d.style.visibility=""}}}})};b.prototype.editInit=function(){this.dblclickListener();this.editKeyListener()}})();(function(){var a=miniYUI;jDbank.ui.mailList=function(c){jDbank.ui.object.call(this,c);this._data={id:c,dList:document.getElementById(c)?document.getElementById(c):null,dUl:document.getElementById(c)?document.getElementById(c).getElementsByTagName("ul")[0]:null,focusedNode:null,focusClass:"selected",hoverClass:"on",flagClass:"up",icoClass:"deleteit",groupIdAttr:"data",tagchar:"_",selectedNum:0,focusIndex:-1,maxNum:10};this._eventType={click:"click",dblclick:"dblclick",icoClick:"icoClick"}};jDbank.ui.mailList.prototype=new jDbank.ui.object();var b=jDbank.ui.mailList;b.prototype.appendNode=function(h,d,e){var j,c,f=0;this._data.dUl=this._data.dList.getElementsByTagName("ul")[0];if(h.length){c=document.createDocumentFragment();for(var g=0;g<(h.length<=this._data.maxNum?h.length:this._data.maxNum);g++){if(this._data.selectedNum>=this._data.maxNum){return}j=document.getElementById(this.idPre+h[g].id);if(!j){f++}else{if(j){if(d){a.addClass(j,this._data.focusClass);this.changeGroupClass(h[g],true,false)}continue}}j=document.createElement("li");if(h[g].selected==1){a.addClass(j,this._data.focusClass)}if(d){j.className=this._data.focusClass}j.id=this.idPre+h[g].id;j.setAttribute(this._data.groupIdAttr,h[g].groupId);j.innerHTML="<a"+(h[g].flag&&h[g].flag==1?' class="'+this._data.flagClass+'"':"")+' title="'+h[g].name+"("+h[g].email+')" href="#"><span class="'+this._data.icoClass+'"></span><strong>'+h[g].name+"<em>("+h[g].email+")</em></strong></a>";c.appendChild(j)}if(!e){this._data.dUl.appendChild(c)}else{e.appendChild(c)}this._data.selectedNum+=f}else{if(this._data.selectedNum>=this._data.maxNum){return}j=document.getElementById(this.idPre+h.id);if(j){if(d){a.addClass(j,this._data.focusClass);this.changeGroupClass(h,true,false)}return}j=document.createElement("li");if(h.selected==1){a.addClass(j,this._data.focusClass)}j.setAttribute(this._data.groupIdAttr,h.groupId);if(d){j.className=this._data.focusClass}j.id=this.idPre+h.id;j.innerHTML="<a"+(h.flag&&h.flag==1?' class="'+this._data.flagClass+'"':"")+' title="'+h.name+"("+h.email+')" href="#"><span class="'+this._data.icoClass+'"></span><strong>'+h.name+"<em>("+h.email+")</em></strong></a>";if(!e){this._data.dUl.appendChild(j)}else{e.appendChild(j)}this._data.selectedNum+=1}};b.prototype.insertNode=function(h,j,d,e){if(!j||!j.nodeType||j.nodeType!=1){return}var l,c,f=0;this._data.dUl=this._data.dList.getElementsByTagName("ul")[0];if(h.length){c=document.createDocumentFragment();for(var g=0;g<(h.length<=this._data.maxNum?h.length:this._data.maxNum);g++){if(this._data.selectedNum>=this._data.maxNum){return}l=document.getElementById(this.idPre+h[g].id);if(!l){f++}else{if(l){if(d){a.addClass(l,this._data.focusClass);this.changeGroupClass(h[g],true,false)}continue}}l=document.createElement("li");if(h[g].selected==1){a.addClass(l,this._data.focusClass)}l.setAttribute(this._data.groupIdAttr,h[g].groupId);if(d){l.className=this._data.focusClass}l.id=this.idPre+h[g].id;l.innerHTML="<a"+(h[g].flag&&h[g].flag==1?' class="'+this._data.flagClass+'"':"")+' title="'+h[g].name+"("+h[g].email+')" href="#"><span class="'+this._data.icoClass+'"></span><strong>'+h[g].name+"<em>("+h[g].email+")</em></strong></a>";c.appendChild(l)}if(!e){this._data.dUl.insertBefore(c,j)}else{e.insertBefore(c,j)}this._data.selectedNum+=f}else{if(this._data.selectedNum>=this._data.maxNum){return}l=document.getElementById(this.idPre+h.id);if(l){if(d){a.addClass(l,this._data.focusClass);this.changeGroupClass(h,true,false)}return}l=document.createElement("li");if(h.selected==1){a.addClass(l,this._data.focusClass)}l.setAttribute(this._data.groupIdAttr,h.groupId);if(d){l.className=this._data.focusClass}l.id=this.idPre+h.id;l.innerHTML="<a"+(h.flag&&h.flag==1?' class="'+this._data.flagClass+'"':"")+' title="'+h.name+"("+h.email+')" href="#"><span class="'+this._data.icoClass+'"></span><strong>'+h.name+"<em>("+h.email+")</em></strong></a>";if(!e){this._data.dUl.insertBefore(l,j)}else{e.insertBefore(l,j)}this._data.selectedNum+=1}};b.prototype.changeGroupClass=function(h,d,l){var f=0;k=0;var n,m;var o,e,i;var c=this._data.tagchar;var g=false;if(typeof(l)=="undefined"){l=true}if(!h.length){n=h.groupId.split(",");for(f=0;f<n.length;f++){o=h.id.replace(/\s/g,"").split(c);if(o.length>2){i=a.clone(o);i.shift();o[1]=i.join(c)}e=o[1]?o[1]:o[0];m=document.getElementById(this.idPre+c+n[f]+c+e);if(m&&d){if(this._data.selectedNum>=this._data.maxNum){return}a.addClass(m,"selected");this.data[this.idPre+c+e].selected=1}else{if(m&&!d){a.removeClass(m,"selected");this.data[this.idPre+c+e].selected=0}}}if(l&&d){this._data.selectedNum++}else{if(l&&!d){this._data.selectedNum--}}}else{for(k=0;k<(h.length<=this._data.maxNum?h.length:this._data.maxNum);k++){n=h[k].groupId.split(",");for(f=0;f<n.length;f++){o=h[k].id.replace(/\s/g,"").split(c);if(o.length>2){i=a.clone(o);i.shift();o[1]=i.join(c)}e=o[1]?o[1]:o[0];m=document.getElementById(this.idPre+c+n[f]+c+e);if(m&&d){if(this._data.selectedNum>=this._data.maxNum){return}if(!a.hasClass(m,"selected")){g=true}a.addClass(m,"selected");this.data[this.idPre+c+e].selected=1}else{if(m&&!d){a.removeClass(m,"selected");this.data[this.idPre+c+e].selected=0}}}if(l&&d&&g){this._data.selectedNum++}else{if(l&&!d){this._data.selectedNum--}}g=false}}};b.prototype.removeNode=function(c){if(c){this._data.dUl.removeChild(c)}};b.prototype.setFocus=function(d){if(d.length){for(var e=0,c=d.length;e<c;e++){a.addClass(d[e],this._data.focusClass)}}else{if(d){a.addClass(d,this._data.focusClass)}}};b.prototype.removeFocus=function(d){if(d.length){for(var e=0,c=d.length;e<c;e++){a.removeClass(d[e],this._data.focusClass)}}else{if(d){a.removeClass(d,this._data.focusClass)}}};b.prototype.getNodeData=function(c){var e,h=0,m=0,f,l,g,n,j=[];var i=new RegExp('<span class="'+this._data.focusClass+'">',"ig");var d=this._data.tagchar;if(c&&!c.length){e=c.innerHTML.toLowerCase().replace(/\n/g,"");h=i.test(e)?1:0;m=a.hasClass(c,this._data.flagClass)?1:0;f=e.replace(/.*<strong.*?>/ig,"").replace(/<em.*?>.*/ig,"").replace(/\s/g,"");l=e.replace(/.*<em.*?>\(/ig,"").replace(/\)<\/.*?em>.*/ig,"").replace(/\s/g,"");g=c.id.replace(/\s/g,"").split(d);if(g[0]){j[0]=g[0]}if(g[1]){j[1]=g[1]}if(typeof(this._data.defaultGroupId)!="undefined"&&g.length>3){n=a.clone(g);n.shift();n.shift();g[2]=n.join(d);j[2]=g[2]}else{if(typeof(this._data.defaultGroupId)=="undefined"&&g.length>2){n=a.clone(g);n.shift();g[1]=n.join(d);j[1]=g[1]}else{if(typeof(this._data.defaultGroupId)!="undefined"){j[2]=g[2]}}}return{id:j[2]?d+j[2]:d+j[1],groupId:c.getAttribute(this._data.groupIdAttr).toString().replace(/\s/g,""),name:f,email:l,flag:m,selected:h}}else{if(c&&c.length){}}};b.prototype.firstNode=function(){this._data.dUl=this._data.dList.getElementsByTagName("ul")[0];return this._data.dUl.getElementsByTagName("li")[0]?this._data.dUl.getElementsByTagName("li")[0]:null};b.prototype.getSelectedNodes=function(c){if(typeof(c)=="undefined"){c=true}var j,f,e=false,h=false;var g=new Array(),d=new Array();j=this._data.dUl.getElementsByTagName("li");for(f=0;f<j.length;f++){if(c&&a.hasClass(j[f],this._data.focusClass)){g[g.length]=j[f];d[d.length]=this.getNodeData(j[f]);if(!h&&a.hasClass(j[f],this._data.flagClass)){h=true}else{if(!e&&!a.hasClass(j[f],this._data.flagClass)){e=true}}}else{if(!c){g[g.length]=j[f];d[d.length]=this.getNodeData(j[f]);if(!h&&a.hasClass(j[f],this._data.flagClass)){h=true}else{if(!e&&!a.hasClass(j[f],this._data.flagClass)){e=true}}}}}return{nodes:g,datas:d,num:j.length,allowUp:e,cancelUp:h}};b.prototype.clickListener=function(f){if(!f){return}var e,d=this,c;a.on(f,"click",function(g){e=a.getTarget(g);if(e.tagName.toLowerCase()=="span"){e=e.parentNode.parentNode;d._eventObj={};d._eventObj.type=d._eventType.icoClick;d._eventObj.clickNode=e;c=d.getHandler(d._eventType.icoClick);if(!c.apply(d,d.getHandlerArguments(d._eventObj))){return false}}else{if((e.tagName.toLowerCase()=="a"&&e.parentNode.tagName.toLowerCase()=="li")||e.tagName.toLowerCase()=="strong"||e.tagName.toLowerCase()=="em"){a.stopEvent(g);if(e.tagName.toLowerCase()=="a"){e=e.parentNode}else{if(e.tagName.toLowerCase()=="strong"){e=e.parentNode.parentNode}else{if(e.tagName.toLowerCase()=="em"){e=e.parentNode.parentNode.parentNode}}}d._eventObj={};d._eventObj.type=d._eventType.click;d._eventObj.clickNode=e;d._eventObj.keyCode=g.keyCode;d._eventObj.ctrlKey=g.ctrlKey;d._eventObj.shiftKey=g.shiftKey;c=d.getHandler(d._eventType.click);if(!c.apply(d,d.getHandlerArguments(d._eventObj))){return false}}}});a.on(f,"dblclick",function(g){e=a.getTarget(g);if(e.tagName.toLowerCase()=="a"||e.tagName.toLowerCase()=="strong"||e.tagName.toLowerCase()=="em"){if(e.tagName.toLowerCase()=="a"){e=e.parentNode}else{if(e.tagName.toLowerCase()=="strong"){e=e.parentNode.parentNode}else{if(e.tagName.toLowerCase()=="em"){e=e.parentNode.parentNode.parentNode}}}d._eventObj={};d._eventObj.type=d._eventType.dblclick;d._eventObj.clickNode=e;c=d.getHandler(d._eventType.dblclick);if(!c.apply(d,d.getHandlerArguments(d._eventObj))){return false}}})};b.prototype.init=function(){this.clickListener(this._data.dList)}})();(function(){var a=miniYUI;jDbank.ui.multiMailList=function(c){jDbank.ui.mailList.call(this,c);this._data.defaultGroupId="1";this._data.searchGroupId="0";this._data.searchUl=null;this._data.groupClass="tickarr";this._data.groupOpenClass="opened";this._data.groupCloseClass="closed";this._eventType.groupClick="groupClick"};jDbank.ui.multiMailList.prototype=new jDbank.ui.mailList();var b=jDbank.ui.multiMailList;b.prototype.groupClickListener=function(g){if(!g){return}var f,e=this,c,d;a.on(g,"click",function(h){f=a.getTarget(h);if(f.tagName.toLowerCase()=="a"){d=a.getNextSibling(f.parentNode);if(f.className==e._data.groupClass){e._eventObj={};e._eventObj.type=e._eventType.groupClick;e._eventObj.addNodes=d.getElementsByTagName("li");c=e.getHandler(e._eventType.groupClick);if(!c.apply(e,e.getHandlerArguments(e._eventObj))){return false}}else{if(f.className==e._data.groupOpenClass||f.className==e._data.groupCloseClass){if(f.className==e._data.groupOpenClass){d.style.display="none";f.className=e._data.groupCloseClass}else{d.style.display="block";f.className=e._data.groupOpenClass}}}}})};b.prototype.init=function(){this._data.searchUl=document.getElementById(this.idPre+this._data.tagchar+this._data.searchGroupId)?document.getElementById(this.idPre+this._data.tagchar+this._data.searchGroupId):null;this.clickListener(this._data.dList);this.groupClickListener(this._data.dList)}})();(function(){jDbank.ui.table=function(tableId){jDbank.ui.object.call(this,tableId);this._tableId=tableId;this._tableObj=document.getElementById(tableId);this._lastSelectedFile=null;this._alterType=0;this._currentItem=null;this._currentItemP=null;this._oldItemName="";this._selectedItems={};this._dCheckboxs=null;this._dTrs=null;this.alterDivId="dbtreealter";this.focusIndex=-1;this._data.ifDelete=false;this._data.multiSelect=false;this._data.multiSelectMove=false;this._data.maxNodeNameLength=jDbank.util.getAvaiFileLen()};jDbank.ui.table.prototype=new jDbank.ui.object();var jut=jDbank.ui.table;jut.prototype.setFocusIndex=function(value){this.focusIndex=value};jut.prototype.getEventHandler=function(eventObj){return this._eventMap[eventObj.type]?this._eventMap[eventObj.type]:function(eventObj){return true}};jut.prototype.getSelectedItems=function(){var dSelectedItems=new Array();for(var key in this._selectedItems){if(typeof(this._selectedItems[key])!="undefined"&&this._selectedItems[key].parentNode&&this._selectedItems[key].style.display!="none"){if(typeof(this._selectedItems[key].data)=="undefined"){this._selectedItems[key].data=this._selectedItems[key].getAttribute("sdata")?eval("("+this._selectedItems[key].getAttribute("sdata")+")"):{}}dSelectedItems[dSelectedItems.length]=this._selectedItems[key]}}return dSelectedItems};jut.prototype.selectAllItem=function(ifCheck,module){var dTrs,i,iLen,oTr;if(typeof(ifCheck)=="undefined"){var ifCheck=true}if(typeof(module)=="undefined"){var module=this._tableObj}if(!this._dCheckboxs&&module){dTrs=jDbank("div.mbody",module).children().children("tbody").children();this._dCheckboxs=dTrs}dTrs=this._dCheckboxs;iLen=dTrs.length;for(i=0;i<iLen;i++){if(dTrs[i]&&jDbank(dTrs[i]).css("display")!="none"){if(!ifCheck){oTr=jDbank(dTrs[i]);if(this._selectedItems[dTrs[i].getAttribute("dtid")]&&oTr.hasClass("selected")){oTr.removeClass("selected");this.changeImg(oTr[0],false);delete this._selectedItems[dTrs[i].getAttribute("dtid")]}}else{oTr=jDbank(dTrs[i]);oTr.addClass("selected");this.changeImg(oTr[0],true);if(!this._selectedItems[dTrs[i].getAttribute("dtid")]){this._selectedItems[dTrs[i].rowIndex]=dTrs[i];dTrs[i].setAttribute("dtid",dTrs[i].rowIndex)}}}}};jut.prototype.setItemSelected=function(oTar,ifMulti){var oTr,i=0,dTrs,arrTemp=new Array();oTar=jDbank(oTar);if(!ifMulti&&this._lastSelectedFile){this.selectAllItem(false)}var iStart=0,iEnd=0;if(oTar[0].tagName.toLowerCase()!="tr"){oTr=oTar.parents("tr")}else{if(oTar[0].tagName.toLowerCase()=="tr"){oTr=oTar}}if(ifMulti=="shift"){this.selectAllItem(false);if(!this._lastSelectedFile){this._lastSelectedFile=oTr}if(!this._dTrs){dTrs=oTr.parent()[0].getElementsByTagName("tr");this._dTrs=dTrs}dTrs=this._dTrs;iEnd=dTrs.length;iStart=iEnd;for(i=0;i<dTrs.length;i++){if(this._lastSelectedFile[0]==dTrs[i]){iStart=i}if(oTr[0]==dTrs[i]){iEnd=i}if((i>=iStart&&i<=iEnd)||(i>=iEnd&&i<=iStart)){jDbank(dTrs[i]).addClass("selected");this.changeImg(dTrs[i],true);this._selectedItems[dTrs[i].rowIndex]=dTrs[i];dTrs[i].setAttribute("dtid",dTrs[i].rowIndex)}}}else{if(ifMulti=="ctrl"||ifMulti=="multi"){if(!oTr.hasClass("selected")){oTr.addClass("selected");this.changeImg(oTr[0],true);this._selectedItems[oTr[0].rowIndex]=oTr[0];oTr[i].setAttribute("dtid",oTr[i].rowIndex)}else{if(ifMulti=="ctrl"){oTr.removeClass("selected");this.changeImg(oTr[0],false);delete this._selectedItems[oTr[0].rowIndex]}}}else{oTr.addClass("selected");this.changeImg(oTr[0],true);this._selectedItems[oTr[0].rowIndex]=oTr[0];oTr[0].setAttribute("dtid",oTr[0].rowIndex)}}if(ifMulti!="shift"){this._lastSelectedFile=oTr}};jut.prototype.changeImg=function(dTr,ifSelect){var dImg=dTr.getElementsByTagName("img")[0];if(!dImg){return}if(ifSelect){dImg.src=dImg.src.replace(/(_on)*\.png$/ig,"_on.png")}else{dImg.src=dImg.src.replace(/(_on)+\.png$/ig,".png")}};jut.prototype.selectItem=function(item){if(item&&item.tagName.toLowerCase()=="tr"){this.setItemSelected(item)}};jut.prototype.unSelectItem=function(item){if(item&&item.tagName.toLowerCase()=="tr"){jDbank(item).removeClass("selected");delete this._selectedItems[item.getAttribute("dtid")]}};jut.prototype.removeItem=function(item){this.unSelectItem(item);if(item.tagName.toLowerCase()=="tr"){item.parentNode.removeChild(item)}};jut.prototype.deleteSelectedItems=function(ifDelete){var self=this,fun,arrTemp=[];self._eventObj={};self._eventObj.type="beforeDelItem";arrTemp=self.getSelectedItems();self._eventObj.delItems=arrTemp;fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}if(typeof(ifDelete)=="undefined"||ifDelete){for(var i=0,iLen=arrTemp.length;i<iLen;i++){arrTemp[i].parentNode.removeChild(arrTemp[i])}}arrTemp=self.getSelectedItems();self._eventObj.delItems=arrTemp;self._eventObj.type="afterDelItem";fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}};jut.prototype.thMouseOn=function(module){var dThs,dCurrent;dThs=module.getElementsByTagName("th");dCurrent=document.getElementById(this._tableId+"current");jDbank(dThs).bind("mouseenter",function(event){jDbank(this).addClass("on");if(dCurrent){dCurrent.style.display="block";dCurrent.style.width=jDbank(this).outerWidth()+"px";dCurrent.style.left=jDbank(this).position().left+"px"}});jDbank(dThs).bind("mouseleave",function(event){jDbank(this).removeClass("on");if(dCurrent){dCurrent.style.display="none"}})};jut.prototype.showFloatObj=function(obj,left,top){if(!obj){return}if(obj){obj=jDbank(obj)[0];obj.style.left=parseInt(left).toString().replace(/\D/ig,"")+"px";obj.style.top=parseInt(top).toString().replace(/\D/ig,"")+"px";if(obj.style.display!="block"){obj.style.display="block"}}};jut.prototype.setInputTextSelected=function(obj){if(!obj){return}obj=jDbank(obj)[0];jDbank(obj).addClass("dtfile");if(obj.tagName.toLowerCase()!="input"&&obj.tagName.toLowerCase()!="textarea"){return}try{obj.focus();obj.select()}catch(e){}};jut.prototype.setAlterText=function(txt){if(document.getElementById(this.alterDivId+"input")){document.getElementById(this.alterDivId+"input").value=txt}};jut.prototype.getAlterText=function(){if(document.getElementById(this.alterDivId+"input")){return document.getElementById(this.alterDivId+"input").value.replace(/[^\u4e00-\u9fa5\w\.\(\)-]*/g,"")}};jut.prototype.showAlterInput=function(left,top){var dDiv=document.getElementById(this.alterDivId);var self=this;self.showFloatObj(dDiv,left,top);self.setInputTextSelected(dDiv.getElementsByTagName("input")[0])};jut.prototype.hideAlterInput=function(obj){if(obj){obj=jDbank(obj)[0];obj.style.top="-9999px"}else{if(document.getElementById(this.alterDivId)){document.getElementById(this.alterDivId).style.top="-9999px"}}};jut.prototype.readyToRename=function(dTr){var dTemp,oTemp,oPos,oSpan;var self=this;oTemp=jDbank(".filetxt",dTr);dTemp=oTemp[0];self._alterType=1;oSpan=jDbank(".dtfile",dTr);oPos=oSpan.offset();if(document.all){oPos.top-=1}self._currentItem=oTemp.parents("tr")[0];self._currentItemP=oTemp[0];self._oldItemName=dTr.data.name.replace(/\.[^\.]*?$/ig,"");self.setAlterText(self._oldItemName);self._eventObj={};self._eventObj.type="beforeRenameItem";self._eventObj.currentItem=self._currentItem;self._eventObj.oldName=self._oldItemName;fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}self._currentItemP.style.visibility="hidden";if(document.getElementById(self.alterDivId+"input")){document.getElementById(self.alterDivId+"input").style.width=(oSpan.width()>40?(oSpan.width()+10):40)+"px"}self.showAlterInput(oPos.left,oPos.top)};jut.prototype.fileSelectInit=function(module,This){var self=This||this;var dTar,oTr,oTar;var oTemp,oPos,oPosnew;var oModule=jDbank(module);module.onselectstart=function(){return false};var dAlterDiv=document.getElementById(self.alterDivId);var dAlterInput=dAlterDiv.getElementsByTagName("input")[0];var fun=null,dWin;if(self._data.fileMenuId){self._data.fileMenu=document.getElementById(self._data.fileMenuId)}if(self._data.folderMenuId){self._data.folderMenu=document.getElementById(self._data.folderMenuId)}oModule.bind("dblclick",function(e){dTar=e.target;oTar=jDbank(dTar);if((dTar.tagName.toLowerCase()=="img"&&jDbank(dTar.parentNode).hasClass("dtfilename"))||(dTar.tagName.toLowerCase()=="strong"&&oTar.hasClass("filetxt"))||dTar.tagName.toLowerCase()=="a"){e.preventDefault();if(oTar[0].tagName.toLowerCase()!="tr"){oTar=oTar.parents("tr");dTar=oTar[0]}if(!dTar.data){dTar.data=dTar.getAttribute("sdata")?eval("("+dTar.getAttribute("sdata")+")"):{}}self._eventObj={};self._eventObj.type="dblclick";self._eventObj.clickNode=dTar;self._eventObj.isFolder=typeof(dTar.data.isFolder)!="undefined"&&dTar.data.isFolder==1?dTar.data.isFolder:0;fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}}});oModule.bind("mousedown",function(e){dTar=e.target;oTar=jDbank(dTar);window.currentFocusedDom=self.focusIndex;e.preventDefault();if(!self._dCheckboxs){self._dCheckboxs=jDbank("div.mbody",self._tableObj).children().children("tbody").children()}if((dTar.tagName.toLowerCase()=="img"&&jDbank(dTar.parentNode).hasClass("dtfilename"))||(dTar.tagName.toLowerCase()=="strong"&&oTar.hasClass("filetxt"))){if(oTar[0].tagName.toLowerCase()!="tr"){oTar=oTar.parents("tr");dTar=oTar[0]}if(e.button==2||(document.all&&e.button==0)){if(oTar.hasClass("selected")){self.setItemSelected(oTar,"multi")}else{self.setItemSelected(oTar)}if(oTar.hasClass("selected")){if(dWin){dWin.style.display="none"}if(!dTar.data){dTar.data=dTar.getAttribute("sdata")?eval("("+dTar.getAttribute("sdata")+")"):{}}if(typeof(dTar.data.type)!="undefined"&&dTar.data.type=="Directory"){dWin=self._data.folderMenu}else{dWin=self._data.fileMenu}if(!dWin){return}self._eventObj={};self._eventObj.type="beforeShowRightMenu";self._eventObj.clickNode=dTar;self._eventObj.isFolder=typeof(dTar.data.isFolder)!="undefined"&&dTar.data.isFolder==1?dTar.data.isFolder:0;fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}jDbank.ui.showSubWindow(dWin,false);if(document.all){dWin.style.top=((jDbank(document).height()-e.pageY-40)>jDbank(dWin).height()?e.pageY:e.pageY-jDbank(dWin).height())+"px"}else{dWin.style.top=((jDbank(document).height()-e.pageY)>jDbank(dWin).height()?e.pageY:e.pageY-jDbank(dWin).height())+"px"}dWin.style.left=e.pageX+"px"}}else{self._eventObj={};self._eventObj.type="beforeFocusItem";self._eventObj.oldFocusItem=self._lastSelectedFile?self._lastSelectedFile[0]:null;self._eventObj.newFocusItem=oTar[0];fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}if(!e.ctrlKey&&!e.shiftKey&&!oTar.hasClass("selected")){self.setItemSelected(oTar)}else{if(e.ctrlKey){self.setItemSelected(oTar,"ctrl")}else{if(e.shiftKey){self.setItemSelected(oTar,"shift")}}}self._eventObj.type="afterFocusItem";fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}}}else{if((dTar.tagName.toLowerCase()=="td"&&oTar.hasClass("dtfilename"))||(dTar.tagName.toLowerCase()=="div"&&oTar.hasClass("mbody"))){if(self._data.multiSelect){fnReset()}oPos=miniYUI.getXY(e);if(jDbank(document.body).width()-oPos.x<20){return}self._data.multiSelect=true;fnShowMultiDiv(oPos);if(dTar.tagName.toLowerCase()=="td"){self._lastSelectedFile=jDbank(dTar.parentNode)}else{if(dTar.tagName.toLowerCase()=="div"&&oTar.hasClass("mbody")){self._lastSelectedFile=jDbank(self._dCheckboxs[self._dCheckboxs.length-1])}}}}});var fnShowMultiDiv=function(oPos){var dDiv=document.getElementById("dbkmultiselectdiv");if(!dDiv){dDiv=document.createElement("div");dDiv.id="dbkmultiselectdiv";document.body.appendChild(dDiv)}dDiv.style.width="0";dDiv.style.height="0";dDiv.className="";dDiv.style.right=(jDbank(window).width()-oPos.x)+"px";dDiv.style.bottom=(jDbank(window).height()-oPos.y)+"px";dDiv.style.top="auto"};var fnReset=function(){self._data.multiSelect=false;self._data.multiSelectMove=false;var dDiv=document.getElementById("dbkmultiselectdiv");if(dDiv){dDiv.style.right="-999%";dDiv.style.width="0";dDiv.style.height="0";dDiv.className=""}};oModule.bind("mousemove",function(e){if(self._data.multiSelect){dTar=e.target;oTar=jDbank(dTar);self._data.multiSelectMove=true;if(dTar.tagName.toLowerCase()=="strong"&&oTar.hasClass("filetxt")){dTar.parentNode.style.zoom=0;oTar=jDbank(dTar.parentNode.parentNode.parentNode)}if(oTar[0].tagName.toLowerCase()=="tr"){self.setItemSelected(oTar,"shift")}var dDiv=document.getElementById("dbkmultiselectdiv");if(dDiv){if(dDiv.className!="dbkmultidivon"){dDiv.className="dbkmultidivon"}oPosnew=miniYUI.getXY(e);if(oPosnew.x>oPos.x){dDiv.style.right="-999%";return}if(oPosnew.y<oPos.y){dDiv.style.top="auto";dDiv.style.bottom=(jDbank(window).height()-oPos.y)+"px"}else{if(oPosnew.y>oPos.y){dDiv.style.bottom="auto";dDiv.style.top=oPos.y+"px"}}dDiv.style.width=Math.abs(oPosnew.x-oPos.x)+"px";dDiv.style.height=Math.abs(oPosnew.y-oPos.y)+"px"}}});oModule.bind("mouseup",function(e){dTar=e.target;oTar=jDbank(dTar);if(dTar.tagName.toLowerCase()=="td"||(dTar.tagName.toLowerCase()=="div"&&self._data.multiSelect)){if(!self._data.multiSelectMove){self.selectAllItem(false)}}fnReset()});oModule.bind("click",function(e){dTar=e.target;oTar=jDbank(dTar);if(dTar.tagName.toLowerCase()=="img"||(dTar.tagName.toLowerCase()=="strong"&&oTar.hasClass("filetxt"))||dTar.tagName.toLowerCase()=="a"){e.preventDefault()}})};jut.prototype.renameItem=function(item,newName){var dAlterDiv=document.getElementById(this.alterDivId);var itemP,fun=null;if(!item&&!newName){var item=this._currentItem?this._currentItem:null;var newName=this.getAlterText();itemP=this._currentItemP?this._currentItemP:null}else{itemP=jDbank(".filetxt",item)[0]}if(dAlterDiv){if(parseInt(dAlterDiv.style.top.replace(/px/ig,""))>=0){if(this._alterType==1){this._eventObj.type="afterRenameItem";this._eventObj.currentItem=item;this._eventObj.newName=newName;this._eventObj.oldName=itemP?itemP.innerHTML:null;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}}else{if(this._alterType==2){this._eventObj.type="afterCreateItem";this._eventObj.currentItem=item;this._eventObj.newName=newName;this._eventObj.oldName=itemP?itemP.innerHTML:null;fun=this.getEventHandler(this._eventObj);if(!fun.apply(this,this.getHandlerArguments(this._eventObj))){return false}}}if(this._alterType>0){if(itemP){itemP.innerHTML=/MSIE/ig.test(navigator.appVersion)?newName.substr(0,jDbank.util.getAvaiFileLen(itemP.parentNode.parentNode.offsetWidth)):newName;itemP.style.visibility=""}this.hideAlterInput(dAlterDiv)}}jDbank(dAlterDiv.getElementsByTagName("input")[0]).removeClass("dtfile");this._alterType=0}};jut.prototype.widthAdapt=function(module,bBind){var dCol=jDbank(module).find("col.recol")[0],dContainer=jDbank(module).find("div.mbody")[0];if(!dCol||!dContainer){return}if(typeof(bBind)=="undefined"){var bBind=true}var YUI=miniYUI;var fnResize=function(){if(!module.offsetHeight){return}var iAdd=19;if(/MSIE 6.0/ig.test(navigator.appVersion)){iAdd=16}if(dContainer&&dContainer.offsetHeight>0&&(dContainer.scrollTop>0||dContainer.scrollHeight>dContainer.offsetHeight)){if(!YUI.hasClass(dCol,"colresized")){YUI.addClass(dCol,"colresized");dCol.style.width=(jDbank(dCol).width()+iAdd)+"px"}}else{if(YUI.hasClass(dCol,"colresized")){YUI.removeClass(dCol,"colresized");dCol.style.width=(jDbank(dCol).width()-iAdd)+"px"}}};fnResize();if(bBind){YUI.on(window,"resize",function(e){fnResize()})}};jut.prototype.readyToCreate=function(dTr){var dTemp,oTemp,oPos;var self=this;oTemp=jDbank(".filetxt",dTr);dTemp=oTemp[0];this._alterType=1;oPos=oTemp.offset();oPos.top-=document.all?4:2;this._currentItem=oTemp.parents("tr")[0];this._currentItemP=oTemp[0];this._oldItemName=this._currentItemP.innerHTML;this.setAlterText(this._oldItemName);self._eventObj={};self._eventObj.type="beforeCreateItem";self._eventObj.currentItem=self._currentItem;self._eventObj.oldName=self._oldItemName;fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}this._currentItemP.style.visibility="hidden";this.showAlterInput(oPos.left,oPos.top);this._alterType=2};jut.prototype.createNode=function(){var dTbody=this._tableObj.getElementsByTagName("table")[1].getElementsByTagName("tbody")[0];dTbody.parentNode.parentNode.scrollTop=0;var dFirstTr=dTbody.getElementsByTagName("tr")[0];var oDate=new Date();var dTr=document.createElement("tr");var dTd=document.createElement("td");dTr.setAttribute("sdata",'{isFolder:"1"}');dTd.className="dtfilename";dTd.innerHTML='<img src="/images/ico_16x16_folder.png" alt="文件夹" /><a class="dtfile" href="#" onfocus="this.blur()"><strong class="filetxt">新建文件夹</strong></a>';dTr.appendChild(dTd);dTd=document.createElement("td");dTd.className="filesize";dTd.innerHTML="";dTr.appendChild(dTd);dTd=document.createElement("td");dTd.innerHTML="文件夹";dTr.appendChild(dTd);dTd=document.createElement("td");dTd.innerHTML=oDate.getFullYear()+"-"+(oDate.getMonth()+1)+"-"+oDate.getDate()+" "+oDate.getHours()+":"+oDate.getMinutes();dTr.appendChild(dTd);if(dFirstTr){dTbody.insertBefore(dTr,dFirstTr)}else{dTbody.appendChild(dTr)}var self=this;setTimeout(function(){self.readyToCreate(dTr)},100)};jut.prototype.keyShortcuts=function(module,This){var self=This||this;var dTar,oModule,arrTemp;oModule=jDbank(module);module=This._tableObj;oModule.bind("click",function(e){dTar=e.target;if(self._alterType>0&&e.target.tagName.toLowerCase()!="input"&&e.target.tagName.toLowerCase()!="a"){self.renameItem()}});var fnMoveFile=function(e,fromTr,ifUp){var oTemp;if(ifUp){oTemp=fromTr.prev();if(oTemp[0]&&jDbank(oTemp[0]).css("display")=="none"){oTemp=oTemp.prev()}if(oTemp[0]&&oTemp[0].tagName.toLowerCase()=="tr"){if(e.shiftKey){self.setItemSelected(oTemp,"shift")}else{self.setItemSelected(oTemp)}}}else{oTemp=fromTr.next();if(oTemp[0]&&jDbank(oTemp[0]).css("display")=="none"){oTemp=oTemp.next()}if(oTemp[0]&&oTemp[0].tagName.toLowerCase()=="tr"){if(e.shiftKey){self.setItemSelected(oTemp,"shift")}else{self.setItemSelected(oTemp)}}}};oModule.bind("keydown",function(e){if(window.currentFocusedDom==self.focusIndex&&e.ctrlKey&&e.keyCode==65){self.selectAllItem();e.preventDefault()}if(window.currentFocusedDom==self.focusIndex&&self._alterType===0){if(e.keyCode==38){if(!self._lastSelectedFile){self._lastSelectedFile=jDbank(module.getElementsByTagName("tr")[0])}fnMoveFile(e,self._lastSelectedFile,true);e.preventDefault()}else{if(e.keyCode==40){if(!self._lastSelectedFile){self._lastSelectedFile=jDbank(module.getElementsByTagName("tr")[0])}fnMoveFile(e,self._lastSelectedFile,false);e.preventDefault()}else{if(e.keyCode==46){self.deleteSelectedItems(self._data.ifDelete)}else{if(e.keyCode==113&&self._lastSelectedFile){self.readyToRename(self._lastSelectedFile[0])}}}}}if(self._alterType>0){if(e.keyCode==13){self.renameItem()}else{if(e.keyCode==27){self._eventObj={};self._eventObj.type="beforeCancelRename";fun=self.getEventHandler(self._eventObj);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}self._currentItemP.innerHTML=/MSIE/ig.test(navigator.appVersion)?self._oldItemName.substr(0,jDbank.util.getAvaiFileLen(self._currentItemP.parentNode.parentNode.offsetWidth)):self._oldItemName;self._currentItemP.style.visibility="";self.hideAlterInput();self._alterType=0}}}})};jut.prototype.init=function(This){This.thMouseOn(This._tableObj);This.keyShortcuts(document,This);This.fileSelectInit(This._tableObj,This);This.widthAdapt(This._tableObj)};jut.prototype.refresh=function(){this.selectAllItem(false);this._tableObj=document.getElementById(this._tableId);this._dCheckboxs=jDbank("div.mbody",this._tableObj).children().children("tbody").children();this._lastSelectedFile=null;this._currentItem=null;this._currentItemP=null;this._oldItemName="";this._selectedItems={};this._dTrs=null;this.widthAdapt(this._tableObj)};jut.prototype.dragFileInit=function(module,This,tableThis){var self=This;var dTar,arrTemp,oModule,arrList=new Array(),i=0;var fun=null,dWin;oModule=jDbank(module);oModule.bind("mousedown",function(e){dTar=e.target;if(e.button==1||(!document.all&&e.button==0)){if(dTar.tagName.toLowerCase()=="img"||(dTar.tagName.toLowerCase()=="strong"&&jDbank(dTar).hasClass("filetxt"))){arrTemp=tableThis.getSelectedItems();arrList.length=0;for(i=0;i<arrTemp.length;i++){arrList[arrList.length]='<img src="'+arrTemp[i].getElementsByTagName("img")[0].src+'"/><strong>'+arrTemp[i].getElementsByTagName("strong")[0].innerHTML+"</strong>"}oTr=jDbank(dTar).parents("tr");if(oTr.hasClass("selected")&&arrTemp.length>0){tableThis._eventObj={};tableThis._eventObj.type="beforeDragItem";tableThis._eventObj.dragItem=oTr[0];fun=tableThis.getEventHandler(tableThis._eventObj);if(!fun.apply(tableThis,tableThis.getHandlerArguments(tableThis._eventObj))){return false}self.startDrag(oTr[0],1);self.setList(arrList,1)}else{}}if(dTar.tagName.toLowerCase()!="input"&&dTar.tagName.toLowerCase()!="textarea"){e.preventDefault()}}})}})();(function(){var a=miniYUI;jDbank.ui.previewList=function(c){jDbank.ui.object.call(this,c);this._eventType={}};jDbank.ui.previewList.prototype=new jDbank.ui.object();var b=jDbank.ui.previewList})();(function(){var YUI=miniYUI;jDbank.ui.simpleResourceList=function(listId){jDbank.ui.object.call(this,listId);this._eventType={afterFocused:"afterFocused",dblclick:"dblclick",del:"delete",afterClicked:"afterClicked"};this._data.listObj=document.getElementById(listId);this._data.length=0;this._data.items={};this._data.selectedItems={};this._data.idPre="li";this._data.maxRows=6;this._data.needSelect=false;this._data.needOperation=true};jDbank.ui.simpleResourceList.prototype=new jDbank.ui.object();var jus=jDbank.ui.simpleResourceList;jus.prototype.getItems=function(){var arr=[],obj=this._data.items;for(key in obj){arr[arr.length]=obj[key]}return arr};jus.prototype.getSelectedItems=function(){var arr=[],obj=this._data.selectedItems;for(key in obj){obj[key].sId=typeof(obj[key].data.sId)!="undefined"?obj[key].data.sId:"";obj[key].sType=typeof(obj[key].data.sType)!="undefined"?obj[key].data.sType:"";obj[key].sName=typeof(obj[key].data.sName)!="undefined"?obj[key].data.sName:"";arr[arr.length]=obj[key]}return arr};jus.prototype.setFilter=function(type){if(type){this._filter=type}};jus.prototype.refresh=function(){this._data.selectedItems=null;this._data.selectedItems={};this._data.items=null;this._data.items={};this._data.length=0};jus.prototype.addItems=function(arrItems,needDel){if(!arrItems.length){return}if(typeof(needDel)=="undefined"){var needDel=true}var i,iLen=arrItems.length,dLi,sId;for(i=0;i<iLen;i++){sId=this._data.idPre+(typeof(arrItems[i].sId)!="undefined"?arrItems[i].sId:arrItems[i].fileId);if(typeof(this._data.items[sId])!="undefined"){continue}dLi=document.createElement("li");if(needDel){dLi.className="clearfix"}dLi.setAttribute("sindex",sId);dLi.sdata='{isFolder:"0",sId:"'+(typeof(arrItems[i].sId)!="undefined"?arrItems[i].sId:arrItems[i].fileId)+'",sType:"'+(typeof(arrItems[i].sType)!="undefined"?arrItems[i].sType:arrItems[i].fileextDesc)+'",sFileext:"'+(typeof(arrItems[i].sFileext)!="undefined"?arrItems[i].sFileext:arrItems[i].fileext)+'",sName:"'+(typeof(arrItems[i].sName)!="undefined"?arrItems[i].sName:arrItems[i].subject)+'"}';dLi.data=eval("("+dLi.sdata+")");dLi.innerHTML='<img src="/images/ico_xiao_file_'+(typeof(arrItems[i].sType)!="undefined"?arrItems[i].sType:arrItems[i].fileextDesc)+'.png" /><a href="javascript:;"'+(needDel?' class="clearfix"':"")+' title="'+(typeof(arrItems[i].sName)!="undefined"?arrItems[i].sName:arrItems[i].subject)+'">'+(needDel?"<span></span>":"")+"<em>"+(typeof(arrItems[i].sName)!="undefined"?arrItems[i].sName:arrItems[i].subject)+"</em></a>";this._data.items[sId]=dLi;this._data.length++}this.rebuild()};jus.prototype.reset=function(){var obj=this._data.selectedItems;for(key in obj){YUI.removeClass(obj[key],"on");delete obj[key]}};jus.prototype._filterItem=function(curType){if(!this._filter||!curType){return true}var filters=this._filter.split(",");if(filters.length==0||filters[0]==".*"){return true}for(var i=0;i<filters.length;i++){if(curType.toLowerCase()==filters[i].toLowerCase()){return true}}return false};jus.prototype.rebuild=function(){var dTable=this._data.listObj.getElementsByTagName("table")[0];dTable.style.display="none";var dTbody=dTable.getElementsByTagName("tbody")[0];var dTr=document.createElement("tr");var dTd,dUl=document.createElement("ul"),dLi;var i=1;var obj=this._data.items;for(key in obj){var data=obj[key].sdata;var jsonData=eval("("+data+")");if(jsonData&&!this._filterItem(jsonData.sFileext)){continue}dLi=document.createElement("li");dLi.className=obj[key].className;dLi.setAttribute("sindex",key);dLi.setAttribute("sdata",obj[key].sdata);dLi.setAttribute("index",i);dLi.data=obj[key].data;dLi.innerHTML=obj[key].innerHTML;dUl.appendChild(dLi);if(i%this._data.maxRows==0){dTd=document.createElement("td");dTd.appendChild(dUl);dTr.appendChild(dTd);dUl=document.createElement("ul")}i++}if((i-1)%this._data.maxRows!=0){dTd=document.createElement("td");dTd.appendChild(dUl);dTr.appendChild(dTd)}if(dTbody){dTable.removeChild(dTbody);dTbody=null}dTbody=document.createElement("tbody");dTbody.appendChild(dTr);dTable.appendChild(dTbody);dTable.style.display=""};jus.prototype.selectInit=function(module){var dTar,dLi,self=this;YUI.on(module,"click",function(e){dTar=YUI.getTarget(e);if(dTar.tagName.toLowerCase()=="div"||dTar.tagName.toLowerCase()=="ul"||dTar.tagName.toLowerCase()=="li"||dTar.tagName.toLowerCase()=="td"){self.reset()}if(dTar.tagName.toLowerCase()=="a"){YUI.stopEvent(e)}self.multiSelect(module,e)})};jus.prototype.operationInit=function(module){var dTar,dUl,dLi,self=this,fun;YUI.on(module,"click",function(e){dTar=YUI.getTarget(e);if(dTar.tagName.toLowerCase()=="span"){dLi=dTar.parentNode.parentNode;dUl=dLi.parentNode;self._eventObj={};self._eventObj.type=self._eventType.del;self._eventObj.deleteNode=dLi;fun=self.getHandler(self._eventObj.type);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}if(typeof(self._data.selectedItems[dLi.getAttribute("sindex")])!="undefined"){delete self._data.selectedItems[dLi.getAttribute("sindex")]}if(typeof(self._data.items[dLi.getAttribute("sindex")])!="undefined"){delete self._data.items[dLi.getAttribute("sindex")];self._data.length--}dUl.removeChild(dLi);self.rebuild()}})};jus.prototype.multiSelect=function(module,e){var dTar=YUI.getTarget(e);var node;YUI.preventDefault(e);if(dTar.tagName.toLowerCase()!="em"&&dTar.tagName.toLowerCase()!="img"&&dTar.tagName.toLowerCase()!="li"){return}if(dTar.tagName.toLowerCase()=="em"){node=dTar.parentNode.parentNode}else{if(dTar.tagName.toLowerCase()=="img"){node=dTar.parentNode}else{if(dTar.tagName.toLowerCase()=="li"){node=dTar}else{return}}}var dTable=this._data.listObj.getElementsByTagName("table")[0];var dTbody=dTable.getElementsByTagName("tbody")[0];var dLis=dTbody.getElementsByTagName("li");var curIndex=parseInt(node.getAttribute("index"));var lastIndex;var len=dLis.length;if(e.ctrlKey&&!e.shiftKey){if(YUI.hasClass(node,"on")){YUI.removeClass(node,"on");delete this._data.selectedItems[node.getAttribute("sindex")]}else{YUI.addClass(node,"on");this._data.selectedItems[node.getAttribute("sindex")]=node}}else{if(e.shiftKey){for(var i=0;i<len;i++){if(YUI.hasClass(dLis[i],"on")&&dLis[i].getAttribute("index")!=curIndex){lastIndex=parseInt(dLis[i].getAttribute("index"));continue}}if(lastIndex&&lastIndex!=curIndex){var startIndex;var endIndex;if(lastIndex<=curIndex){startIndex=lastIndex;endIndex=curIndex}else{startIndex=curIndex;endIndex=lastIndex}this.reset();for(i=startIndex;i<=endIndex&&i<len;i++){var item=dLis[i-1];YUI.addClass(item,"on");this._data.selectedItems[item.getAttribute("sindex")]=item}}}else{this.reset();YUI.addClass(node,"on");this._data.selectedItems[node.getAttribute("sindex")]=node}}var self=this;self._eventObj={};self._eventObj.type="afterClicked";self._eventObj.curNode=node;fun=self.getHandler(self._eventObj.type);if(!fun.apply(self,self.getHandlerArguments(self._eventObj))){return false}};jus.prototype.dataInit=function(module){var dLis=module.getElementsByTagName("li"),iLen=dLis.length,i=0;this._data.length=iLen;for(i=0;i<iLen;i++){this._data.items[this._data.idPre+i]=dLis[i];dLis[i].sdata=dLis[i].getAttribute("sdata");dLis[i].data=eval("("+dLis[i].getAttribute("sdata")+")");dLis[i].setAttribute("sindex",this._data.idPre+i)}};jus.prototype.styleInit=function(module){var dTar;YUI.on(module,"mouseover",function(e){dTar=YUI.getTarget(e);if(dTar.tagName.toLowerCase()=="span"){YUI.addClass(dTar,"on")}});YUI.on(module,"mouseout",function(e){dTar=YUI.getTarget(e);if(dTar.tagName.toLowerCase()=="span"){YUI.removeClass(dTar,"on")}})};jus.prototype.init=function(){var module=this._data.listObj;this.dataInit(module);if(this._data.needSelect){this.selectInit(module)}if(this._data.needOperation){this.operationInit(module)}if(/MSIE/ig.test(navigator.appVersion)){this.styleInit(module)}}})();